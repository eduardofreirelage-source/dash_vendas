<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maestro Food Dashboard - HYPER OTIMIZADO</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .performance-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            animation: pulse 2s infinite;
        }

        .mega-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
            animation: glow 3s infinite;
        }

        .hyper-badge {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
            animation: hyper 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); }
            50% { box-shadow: 0 6px 25px rgba(245, 158, 11, 0.6); }
        }

        @keyframes hyper {
            0%, 100% { 
                box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 8px 30px rgba(220, 38, 38, 0.8);
                transform: scale(1.08);
            }
        }

        .status-indicators {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .status-indicator {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 25px;
            padding: 8px 16px;
            color: white;
            font-weight: 500;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .status-indicator.success {
            background: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.5);
        }

        .status-indicator.warning {
            background: rgba(251, 191, 36, 0.2);
            border-color: rgba(251, 191, 36, 0.5);
        }

        .status-indicator.error {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .performance-metric {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 12px 16px;
            color: white;
            text-align: center;
        }

        .metric-label {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .optimization-info {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            color: white;
            font-size: 0.9rem;
            text-align: center;
        }

        .period-info {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 30px;
            text-align: center;
            color: white;
            font-weight: 500;
        }

        .filters-container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            color: white;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.8);
            background: rgba(255,255,255,0.15);
        }

        .filter-group select option {
            background: #333;
            color: white;
        }

        .filter-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-mega {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-hyper {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .kpis-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .kpi-card:hover::before {
            left: 100%;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
        }

        .kpi-title {
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .kpi-value {
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .kpi-comparison {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .comparison-positive {
            color: #22c55e;
        }

        .comparison-negative {
            color: #ef4444;
        }

        .comparison-neutral {
            color: rgba(255,255,255,0.6);
        }

        .chart-container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .chart-title {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .data-table-container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .table-title {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .table-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .table-info {
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
        }

        .virtual-table {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .table-header-row {
            background: rgba(255,255,255,0.1);
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            gap: 1px;
            padding: 15px;
            font-weight: 600;
            color: white;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .table-body {
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) transparent;
        }

        .table-body::-webkit-scrollbar {
            width: 8px;
        }

        .table-body::-webkit-scrollbar-track {
            background: transparent;
        }

        .table-body::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        .table-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            gap: 1px;
            padding: 12px 15px;
            color: rgba(255,255,255,0.9);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: background-color 0.2s ease;
        }

        .table-row:hover {
            background: rgba(255,255,255,0.1);
        }

        .table-cell {
            font-size: 0.85rem;
        }

        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .pagination-info {
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .loading-content {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            color: white;
            max-width: 400px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-container {
            width: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px auto;
        }

        .progress-bar {
            height: 20px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 10px;
            }
            
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .kpis-container {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .performance-metrics {
                grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            }

            .table-header-row,
            .table-row {
                grid-template-columns: 1fr 1fr 1fr;
            }

            .table-cell:nth-child(4),
            .table-cell:nth-child(5) {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>üöÄ Dashboard HYPER Otimizado</h3>
            <p id="loadingStatus">Inicializando sistema HYPER avan√ßado...</p>
            <div class="progress-container">
                <div id="loadingProgress" class="progress-bar">0%</div>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <h1>
                üçΩÔ∏è Maestro Food Dashboard
                <span class="performance-badge">‚ö° ULTRA</span>
                <span class="mega-badge">üöÄ MEGA</span>
                <span class="hyper-badge">üî• HYPER</span>
            </h1>
            <div class="status-indicators">
                <div id="supabaseStatus" class="status-indicator warning">‚è≥ Conectando...</div>
                <div id="dataStatus" class="status-indicator warning">‚è≥ Carregando...</div>
                <div id="cacheStatus" class="status-indicator warning">‚è≥ Cache...</div>
                <div id="indexStatus" class="status-indicator warning">‚è≥ √çndices...</div>
                <div id="processStatus" class="status-indicator warning">‚è≥ Processando...</div>
                <div id="virtualStatus" class="status-indicator warning">‚è≥ Virtual...</div>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="performance-metrics">
            <div class="performance-metric">
                <div class="metric-label">Tempo Total</div>
                <div class="metric-value" id="loadTime">-</div>
            </div>
            <div class="performance-metric">
                <div class="metric-label">Registros/Seg</div>
                <div class="metric-value" id="throughput">-</div>
            </div>
            <div class="performance-metric">
                <div class="metric-label">Cache Hit</div>
                <div class="metric-value" id="cacheHitRate">-</div>
            </div>
            <div class="performance-metric">
                <div class="metric-label">√çndices</div>
                <div class="metric-value" id="indexCount">-</div>
            </div>
            <div class="performance-metric">
                <div class="metric-label">Mem√≥ria</div>
                <div class="metric-value" id="memoryUsage">-</div>
            </div>
            <div class="performance-metric">
                <div class="metric-label">Workers</div>
                <div class="metric-value" id="workerCount">-</div>
            </div>
            <div class="performance-metric">
                <div class="metric-label">FPS</div>
                <div class="metric-value" id="fpsCounter">-</div>
            </div>
            <div class="performance-metric">
                <div class="metric-label">Filtro (ms)</div>
                <div class="metric-value" id="filterTime">-</div>
            </div>
        </div>

        <!-- Optimization Info -->
        <div class="optimization-info" id="optimizationInfo">
            üî• Sistema HYPER: Cache + √çndices + Workers + Virtual + Algoritmos Avan√ßados
        </div>

        <!-- Period Info -->
        <div class="period-info" id="periodInfo">
            üìÖ Per√≠odo: Carregando...
        </div>

        <!-- Filters -->
        <div class="filters-container">
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="filterUnidade">üè¢ Unidade</label>
                    <select id="filterUnidade">
                        <option value="">Todas</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filterLoja">üè™ Nome da Loja (Top 10)</label>
                    <select id="filterLoja">
                        <option value="">Todas</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="dataInicial">üìÖ Data Inicial</label>
                    <input type="date" id="dataInicial">
                </div>

                <div class="filter-group">
                    <label for="dataFinal">üìÖ Data Final</label>
                    <input type="date" id="dataFinal">
                </div>

                <div class="filter-group">
                    <label for="filterPeriodo">‚è∞ Per√≠odo R√°pido</label>
                    <select id="filterPeriodo">
                        <option value="">Personalizado</option>
                        <option value="hoje">Hoje</option>
                        <option value="ontem">Ontem</option>
                        <option value="ultimos7dias">√öltimos 7 dias</option>
                        <option value="ultimos30dias">√öltimos 30 dias</option>
                        <option value="mesAtual">M√™s atual</option>
                        <option value="mesAnterior">M√™s anterior</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filterTurno">üåÖ Turno</label>
                    <select id="filterTurno">
                        <option value="">Todos</option>
                        <option value="Manh√£">Manh√£</option>
                        <option value="Tarde">Tarde</option>
                        <option value="Noite">Noite</option>
                        <option value="Madrugada">Madrugada</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filterCanal">üì± Canal de Venda</label>
                    <select id="filterCanal">
                        <option value="">Todos</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filterPagamento">üí≥ Pagamento</label>
                    <select id="filterPagamento">
                        <option value="">Todos</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filterCancelado">‚ùå Cancelado</label>
                    <select id="filterCancelado">
                        <option value="">Todos</option>
                        <option value="true">Sim</option>
                        <option value="false">N√£o</option>
                    </select>
                </div>
            </div>

            <div class="filter-actions">
                <button class="btn btn-primary" onclick="applyFilters()" id="applyBtn">üîç Aplicar Filtros</button>
                <button class="btn btn-secondary" onclick="clearFilters()">üîÑ Limpar Filtros</button>
                <button class="btn btn-hyper" onclick="rebuildIndexes()">üî• Reconstruir √çndices</button>
                <button class="btn btn-mega" onclick="optimizeMemory()">üß† Otimizar Mem√≥ria</button>
                <button class="btn btn-secondary" onclick="clearCache()">üóëÔ∏è Limpar Cache</button>
                <button class="btn btn-secondary" onclick="debugInfo()">üîß Debug</button>
            </div>
        </div>

        <!-- KPIs -->
        <div class="kpis-container">
            <div class="kpi-card">
                <div class="kpi-title">üì¶ Pedidos</div>
                <div class="kpi-value" id="kpiPedidos">-</div>
                <div class="kpi-comparison" id="compPedidos">
                    <span class="comparison-neutral">‚Äî N/A</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-title">üéØ Ticket M√©dio</div>
                <div class="kpi-value" id="kpiTicketMedio">R$ -</div>
                <div class="kpi-comparison" id="compTicketMedio">
                    <span class="comparison-neutral">‚Äî N/A</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-title">üí∞ Faturamento</div>
                <div class="kpi-value" id="kpiFaturamento">R$ -</div>
                <div class="kpi-comparison" id="compFaturamento">
                    <span class="comparison-neutral">‚Äî N/A</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-title">üìà Faturamento M√©dio/Dia</div>
                <div class="kpi-value" id="kpiFaturamentoDia">R$ -</div>
                <div class="kpi-comparison" id="compFaturamentoDia">
                    <span class="comparison-neutral">‚Äî N/A</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-title">üéÅ Incentivos</div>
                <div class="kpi-value" id="kpiIncentivos">R$ -</div>
                <div class="kpi-comparison" id="compIncentivos">
                    <span class="comparison-neutral">‚Äî N/A</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-title">üìä Incentivos %</div>
                <div class="kpi-value" id="kpiIncentivosPercent">-%</div>
                <div class="kpi-comparison" id="compIncentivosPercent">
                    <span class="comparison-neutral">‚Äî N/A</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-title">üöö Frete</div>
                <div class="kpi-value" id="kpiFrete">R$ -</div>
                <div class="kpi-comparison" id="compFrete">
                    <span class="comparison-neutral">‚Äî N/A</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-title">üíé Faturamento L√≠quido</div>
                <div class="kpi-value" id="kpiFaturamentoLiquido">R$ -</div>
                <div class="kpi-comparison" id="compFaturamentoLiquido">
                    <span class="comparison-neutral">‚Äî N/A</span>
                </div>
            </div>
        </div>

        <!-- Chart -->
        <div class="chart-container">
            <div class="chart-title">üìä Receita Di√°ria (Renderiza√ß√£o HYPER-Otimizada)</div>
            <canvas id="revenueChart" width="400" height="200"></canvas>
        </div>

        <!-- Virtual Data Table -->
        <div class="data-table-container">
            <div class="table-header">
                <div class="table-title">üìã Dados Detalhados (Pagina√ß√£o Virtual HYPER)</div>
                <div class="table-controls">
                    <div class="table-info" id="tableInfo">Carregando...</div>
                    <select id="pageSize" onchange="changePageSize()">
                        <option value="50">50 por p√°gina</option>
                        <option value="100" selected>100 por p√°gina</option>
                        <option value="250">250 por p√°gina</option>
                        <option value="500">500 por p√°gina</option>
                        <option value="1000">1000 por p√°gina</option>
                    </select>
                </div>
            </div>
            
            <div class="virtual-table">
                <div class="table-header-row">
                    <div>Data</div>
                    <div>Loja</div>
                    <div>Faturamento</div>
                    <div>Desconto</div>
                    <div>Turno</div>
                </div>
                <div class="table-body" id="virtualTableBody">
                    <!-- Dados ser√£o inseridos via JavaScript -->
                </div>
            </div>
            
            <div class="pagination-controls">
                <button class="btn btn-secondary" onclick="previousPage()" id="prevBtn">‚¨ÖÔ∏è Anterior</button>
                <div class="pagination-info" id="paginationInfo">P√°gina 1 de 1</div>
                <button class="btn btn-secondary" onclick="nextPage()" id="nextBtn">Pr√≥xima ‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√£o do Supabase
        const SUPABASE_URL = 'https://uahmcfzerofhzjvlzrqc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVhaG1jZnplcm9maHpqdmx6cnFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTg2MzQsImV4cCI6MjA3MDczNDYzNH0.lPVr3wmrXAmSMY5j7JFy6mI87T3I2TxhVKV-gLc7_VU';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Vari√°veis globais para HYPER otimiza√ß√£o
        let allData = [];
        let filteredData = [];
        let minISO = '';
        let maxISO = '';
        let chart = null;
        let currentPage = 1;
        let pageSize = 100;
        let totalPages = 1;
        let activeWorkers = [];
        let fpsCounter = 0;
        let lastFrameTime = 0;
        let filterTime = 0;

        // M√©tricas de performance HYPER avan√ßadas
        let performanceMetrics = {
            startTime: Date.now(),
            loadTime: 0,
            throughput: 0,
            cacheHits: 0,
            cacheMisses: 0,
            memoryUsage: 0,
            workerCount: 0,
            fps: 0,
            indexCount: 0,
            filterTime: 0
        };

        // Sistema de Cache Inteligente HYPER
        class HyperIntelligentCache {
            constructor() {
                this.cache = new Map();
                this.lruOrder = new Map();
                this.accessCount = new Map(); // Para LFU
                this.maxSize = 5000; // Aumentado para HYPER
                this.ttl = 15 * 60 * 1000; // 15 minutos TTL
                this.hits = 0;
                this.misses = 0;
                this.compressionEnabled = true;
                this.bloomFilter = new Set(); // Bloom filter simples
            }

            set(key, value) {
                // Implementar LRU + LFU eviction h√≠brida
                if (this.cache.size >= this.maxSize) {
                    this.evictLeastUseful();
                }

                // Compress√£o avan√ßada para arrays grandes
                let compressedValue = value;
                if (this.compressionEnabled && Array.isArray(value) && value.length > 500) {
                    compressedValue = {
                        compressed: true,
                        data: this.compress(JSON.stringify(value))
                    };
                }

                this.cache.set(key, {
                    value: compressedValue,
                    timestamp: Date.now()
                });
                
                this.lruOrder.set(key, Date.now());
                this.accessCount.set(key, 1);
                this.bloomFilter.add(key);
            }

            get(key) {
                // Verificar bloom filter primeiro
                if (!this.bloomFilter.has(key)) {
                    this.misses++;
                    return null;
                }

                const item = this.cache.get(key);
                
                if (!item) {
                    this.misses++;
                    return null;
                }

                // Verificar TTL
                if (Date.now() - item.timestamp > this.ttl) {
                    this.cache.delete(key);
                    this.lruOrder.delete(key);
                    this.accessCount.delete(key);
                    this.bloomFilter.delete(key);
                    this.misses++;
                    return null;
                }

                // Atualizar LRU e LFU
                this.lruOrder.set(key, Date.now());
                this.accessCount.set(key, (this.accessCount.get(key) || 0) + 1);
                this.hits++;

                // Descomprimir se necess√°rio
                let value = item.value;
                if (value && value.compressed) {
                    value = JSON.parse(this.decompress(value.data));
                }

                return value;
            }

            evictLeastUseful() {
                // Algoritmo h√≠brido: remover item com menor score (frequ√™ncia * rec√™ncia)
                let minScore = Infinity;
                let keyToEvict = null;
                const now = Date.now();

                for (const [key, lastAccess] of this.lruOrder.entries()) {
                    const frequency = this.accessCount.get(key) || 1;
                    const recency = now - lastAccess;
                    const score = frequency / (recency + 1); // Menor score = menos √∫til

                    if (score < minScore) {
                        minScore = score;
                        keyToEvict = key;
                    }
                }

                if (keyToEvict) {
                    this.cache.delete(keyToEvict);
                    this.lruOrder.delete(keyToEvict);
                    this.accessCount.delete(keyToEvict);
                    this.bloomFilter.delete(keyToEvict);
                }
            }

            compress(str) {
                // Compress√£o simples baseada em repeti√ß√µes
                return str.replace(/(.)\1{2,}/g, (match, char) => `${char}*${match.length}`);
            }

            decompress(str) {
                // Descompress√£o
                return str.replace(/(.)\*(\d+)/g, (match, char, count) => char.repeat(parseInt(count)));
            }

            clear() {
                this.cache.clear();
                this.lruOrder.clear();
                this.accessCount.clear();
                this.bloomFilter.clear();
                this.hits = 0;
                this.misses = 0;
            }

            getHitRate() {
                const total = this.hits + this.misses;
                return total > 0 ? (this.hits / total * 100).toFixed(1) : 0;
            }

            getSize() {
                return this.cache.size;
            }

            optimize() {
                // Remover entradas expiradas e otimizar estruturas
                const now = Date.now();
                const keysToRemove = [];

                for (const [key, item] of this.cache.entries()) {
                    if (now - item.timestamp > this.ttl) {
                        keysToRemove.push(key);
                    }
                }

                keysToRemove.forEach(key => {
                    this.cache.delete(key);
                    this.lruOrder.delete(key);
                    this.accessCount.delete(key);
                    this.bloomFilter.delete(key);
                });

                console.log('üî• Cache HYPER otimizado:', this.cache.size, 'entradas restantes');
            }
        }

        const hyperCache = new HyperIntelligentCache();

        // Sistema de √çndices em Mem√≥ria HYPER
        class HyperIndexSystem {
            constructor() {
                this.indexes = new Map();
                this.multiIndexes = new Map(); // Para consultas com m√∫ltiplos filtros
                this.rangeIndexes = new Map(); // Para consultas de intervalo (datas)
                this.indexCount = 0;
            }

            buildIndexes(data) {
                console.log('üî• Construindo √≠ndices HYPER...');
                const startTime = Date.now();

                // Limpar √≠ndices existentes
                this.indexes.clear();
                this.multiIndexes.clear();
                this.rangeIndexes.clear();

                // √çndices simples
                const fields = ['unidade', 'Nome da loja', 'turno', 'Canal de venda', 'pagamento', 'cancelado'];
                
                fields.forEach(field => {
                    const index = new Map();
                    data.forEach((record, i) => {
                        const value = record[field];
                        if (value !== undefined && value !== null) {
                            if (!index.has(value)) {
                                index.set(value, []);
                            }
                            index.get(value).push(i);
                        }
                    });
                    this.indexes.set(field, index);
                });

                // √çndice de intervalo para datas (B-Tree simplificado)
                this.buildDateRangeIndex(data);

                // √çndices compostos para consultas frequentes
                this.buildCompositeIndexes(data);

                this.indexCount = this.indexes.size + this.multiIndexes.size + this.rangeIndexes.size;
                const buildTime = Date.now() - startTime;
                console.log(`‚úÖ √çndices HYPER constru√≠dos: ${this.indexCount} √≠ndices em ${buildTime}ms`);
            }

            buildDateRangeIndex(data) {
                const dateIndex = [];
                data.forEach((record, i) => {
                    if (record.dia) {
                        dateIndex.push({ date: record.dia, index: i });
                    }
                });
                
                // Ordenar por data para busca bin√°ria
                dateIndex.sort((a, b) => a.date.localeCompare(b.date));
                this.rangeIndexes.set('dia', dateIndex);
            }

            buildCompositeIndexes(data) {
                // √çndice composto: unidade + loja
                const unidadeLojaIndex = new Map();
                data.forEach((record, i) => {
                    const key = `${record.unidade || ''}|${record['Nome da loja'] || ''}`;
                    if (!unidadeLojaIndex.has(key)) {
                        unidadeLojaIndex.set(key, []);
                    }
                    unidadeLojaIndex.get(key).push(i);
                });
                this.multiIndexes.set('unidade_loja', unidadeLojaIndex);

                // √çndice composto: turno + canal
                const turnoCanelIndex = new Map();
                data.forEach((record, i) => {
                    const key = `${record.turno || ''}|${record['Canal de venda'] || ''}`;
                    if (!turnoCanelIndex.has(key)) {
                        turnoCanelIndex.set(key, []);
                    }
                    turnoCanelIndex.get(key).push(i);
                });
                this.multiIndexes.set('turno_canal', turnoCanelIndex);
            }

            query(filters) {
                const startTime = Date.now();
                let resultIndexes = null;

                // Usar √≠ndices para filtros simples
                for (const [field, value] of Object.entries(filters)) {
                    if (!value || field === 'dataInicial' || field === 'dataFinal') continue;

                    const index = this.indexes.get(field);
                    if (index && index.has(value)) {
                        const fieldIndexes = new Set(index.get(value));
                        
                        if (resultIndexes === null) {
                            resultIndexes = fieldIndexes;
                        } else {
                            // Interse√ß√£o
                            resultIndexes = new Set([...resultIndexes].filter(x => fieldIndexes.has(x)));
                        }
                    }
                }

                // Aplicar filtro de data usando √≠ndice de intervalo
                if (filters.dataInicial || filters.dataFinal) {
                    const dateIndexes = this.queryDateRange(filters.dataInicial, filters.dataFinal);
                    
                    if (resultIndexes === null) {
                        resultIndexes = new Set(dateIndexes);
                    } else {
                        resultIndexes = new Set([...resultIndexes].filter(x => dateIndexes.has(x)));
                    }
                }

                const queryTime = Date.now() - startTime;
                console.log(`üî• Consulta de √≠ndice HYPER: ${queryTime}ms`);

                return resultIndexes ? [...resultIndexes] : null;
            }

            queryDateRange(startDate, endDate) {
                const dateIndex = this.rangeIndexes.get('dia');
                if (!dateIndex) return new Set();

                const result = new Set();
                
                // Busca bin√°ria para encontrar in√≠cio do intervalo
                let start = 0;
                let end = dateIndex.length - 1;

                if (startDate) {
                    while (start <= end) {
                        const mid = Math.floor((start + end) / 2);
                        if (dateIndex[mid].date < startDate) {
                            start = mid + 1;
                        } else {
                            end = mid - 1;
                        }
                    }
                }

                // Coletar todos os √≠ndices no intervalo
                for (let i = start; i < dateIndex.length; i++) {
                    const item = dateIndex[i];
                    if (endDate && item.date > endDate) break;
                    result.add(item.index);
                }

                return result;
            }

            getStats() {
                return {
                    totalIndexes: this.indexCount,
                    simpleIndexes: this.indexes.size,
                    compositeIndexes: this.multiIndexes.size,
                    rangeIndexes: this.rangeIndexes.size
                };
            }
        }

        const hyperIndexSystem = new HyperIndexSystem();

        // Pool de Web Workers HYPER
        class HyperWorkerPool {
            constructor(size = 6) { // Mais workers para HYPER
                this.workers = [];
                this.available = [];
                this.busy = [];
                this.size = size;
                this.taskQueue = [];
                this.completedTasks = 0;
                
                this.initializeWorkers();
            }

            initializeWorkers() {
                for (let i = 0; i < this.size; i++) {
                    const worker = this.createHyperWorker();
                    worker.id = i;
                    this.workers.push(worker);
                    this.available.push(worker);
                }
                console.log(`üî• Pool HYPER de ${this.size} workers inicializado`);
            }

            createHyperWorker() {
                const workerCode = `
                    self.onmessage = function(e) {
                        const { taskId, data, operation, params } = e.data;
                        
                        try {
                            let result;
                            const startTime = Date.now();
                            
                            switch(operation) {
                                case 'filter':
                                    result = filterDataHyper(data, params.filters, params.indexes);
                                    break;
                                case 'aggregate':
                                    result = aggregateDataHyper(data);
                                    break;
                                case 'groupByDate':
                                    result = groupByDateHyper(data);
                                    break;
                                case 'sort':
                                    result = sortDataHyper(data, params.field, params.direction);
                                    break;
                                case 'paginate':
                                    result = paginateDataHyper(data, params.page, params.size);
                                    break;
                                case 'batchProcess':
                                    result = batchProcessHyper(data, params.batchSize);
                                    break;
                                default:
                                    result = data;
                            }
                            
                            const processingTime = Date.now() - startTime;
                            self.postMessage({ taskId, success: true, result: result, processingTime: processingTime });
                        } catch (error) {
                            self.postMessage({ taskId, success: false, error: error.message });
                        }
                    };

                    function filterDataHyper(data, filters, indexes) {
                        // Usar √≠ndices se fornecidos
                        if (indexes && indexes.length > 0) {
                            return indexes.map(i => data[i]).filter(record => {
                                // Aplicar filtros restantes que n√£o foram cobertos pelos √≠ndices
                                if (filters.cancelado !== '') {
                                    const isCancelado = record.cancelado === true || record.cancelado === 'true';
                                    if (filters.cancelado === 'true' && !isCancelado) return false;
                                    if (filters.cancelado === 'false' && isCancelado) return false;
                                }
                                return true;
                            });
                        }

                        // Filtro tradicional se n√£o h√° √≠ndices
                        return data.filter(record => {
                            if (filters.unidade && record.unidade !== filters.unidade) return false;
                            if (filters.loja && record['Nome da loja'] !== filters.loja) return false;
                            if (filters.dataInicial && record.dia < filters.dataInicial) return false;
                            if (filters.dataFinal && record.dia > filters.dataFinal) return false;
                            if (filters.turno && record.turno !== filters.turno) return false;
                            if (filters.canal && record['Canal de venda'] !== filters.canal) return false;
                            if (filters.pagamento && record.pagamento !== filters.pagamento) return false;
                            if (filters.cancelado !== '') {
                                const isCancelado = record.cancelado === true || record.cancelado === 'true';
                                if (filters.cancelado === 'true' && !isCancelado) return false;
                                if (filters.cancelado === 'false' && isCancelado) return false;
                            }
                            return true;
                        });
                    }

                    function aggregateDataHyper(data) {
                        // Agrega√ß√£o otimizada com processamento em lotes
                        const batchSize = 10000;
                        let pedidos = 0;
                        let faturamento = 0;
                        let desconto = 0;
                        let frete = 0;

                        for (let i = 0; i < data.length; i += batchSize) {
                            const batch = data.slice(i, i + batchSize);
                            
                            for (const record of batch) {
                                pedidos++;
                                faturamento += parseBRNumber(record.fat);
                                desconto += parseBRNumber(record.des);
                                frete += parseBRNumber(record.fre);
                            }
                        }
                        
                        return {
                            pedidos,
                            faturamento,
                            desconto,
                            frete,
                            ticketMedio: pedidos > 0 ? faturamento / pedidos : 0,
                            faturamentoLiquido: faturamento - desconto,
                            incentivosPercent: faturamento > 0 ? (desconto / faturamento) * 100 : 0
                        };
                    }

                    function groupByDateHyper(data) {
                        const dailyRevenue = new Map(); // Usar Map para melhor performance
                        
                        for (const record of data) {
                            const day = record.dia;
                            if (day) {
                                const current = dailyRevenue.get(day) || 0;
                                dailyRevenue.set(day, current + parseBRNumber(record.fat));
                            }
                        }
                        
                        // Converter Map para Object
                        const result = {};
                        for (const [key, value] of dailyRevenue.entries()) {
                            result[key] = value;
                        }
                        return result;
                    }

                    function sortDataHyper(data, field, direction) {
                        // Usar algoritmo de ordena√ß√£o otimizado
                        return data.sort((a, b) => {
                            const aVal = a[field];
                            const bVal = b[field];
                            
                            // Otimiza√ß√£o para n√∫meros
                            if (typeof aVal === 'number' && typeof bVal === 'number') {
                                return direction === 'desc' ? bVal - aVal : aVal - bVal;
                            }
                            
                            // Compara√ß√£o de strings otimizada
                            const comparison = aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
                            return direction === 'desc' ? -comparison : comparison;
                        });
                    }

                    function paginateDataHyper(data, page, size) {
                        const start = (page - 1) * size;
                        const end = start + size;
                        return {
                            data: data.slice(start, end),
                            total: data.length,
                            pages: Math.ceil(data.length / size)
                        };
                    }

                    function batchProcessHyper(data, batchSize) {
                        const batches = [];
                        for (let i = 0; i < data.length; i += batchSize) {
                            batches.push(data.slice(i, i + batchSize));
                        }
                        return batches;
                    }

                    function parseBRNumber(value) {
                        if (!value) return 0;
                        if (typeof value === 'number') return value;
                        const str = value.toString().replace(',', '.');
                        const num = parseFloat(str);
                        return isNaN(num) ? 0 : num;
                    }
                `;
                
                const blob = new Blob([workerCode], { type: 'application/javascript' });
                return new Worker(URL.createObjectURL(blob));
            }

            async execute(operation, data, params = {}) {
                return new Promise((resolve, reject) => {
                    const taskId = Date.now() + Math.random();
                    
                    if (this.available.length === 0) {
                        this.taskQueue.push({ taskId, operation, data, params, resolve, reject });
                        return;
                    }

                    const worker = this.available.pop();
                    this.busy.push(worker);

                    const timeout = setTimeout(() => {
                        reject(new Error('Worker timeout HYPER'));
                        this.releaseWorker(worker);
                    }, 45000); // 45s timeout para HYPER

                    worker.onmessage = (e) => {
                        if (e.data.taskId === taskId) {
                            clearTimeout(timeout);
                            this.releaseWorker(worker);
                            this.completedTasks++;
                            
                            if (e.data.success) {
                                resolve(e.data.result);
                            } else {
                                reject(new Error(e.data.error));
                            }
                        }
                    };

                    worker.postMessage({ taskId, operation, data, params });
                });
            }

            releaseWorker(worker) {
                const busyIndex = this.busy.indexOf(worker);
                if (busyIndex > -1) {
                    this.busy.splice(busyIndex, 1);
                    this.available.push(worker);

                    if (this.taskQueue.length > 0) {
                        const task = this.taskQueue.shift();
                        this.execute(task.operation, task.data, task.params)
                            .then(task.resolve)
                            .catch(task.reject);
                    }
                }
            }

            getStats() {
                return {
                    total: this.workers.length,
                    available: this.available.length,
                    busy: this.busy.length,
                    queued: this.taskQueue.length,
                    completed: this.completedTasks
                };
            }

            terminate() {
                this.workers.forEach(worker => worker.terminate());
                this.workers = [];
                this.available = [];
                this.busy = [];
                this.taskQueue = [];
            }
        }

        const hyperWorkerPool = new HyperWorkerPool(6);

        // Monitor de FPS HYPER
        function updateFPS() {
            const now = performance.now();
            if (lastFrameTime) {
                const delta = now - lastFrameTime;
                fpsCounter = Math.round(1000 / delta);
                document.getElementById('fpsCounter').textContent = fpsCounter;
            }
            lastFrameTime = now;
            requestAnimationFrame(updateFPS);
        }

        // Fun√ß√£o para converter data para formato ISO (HYPER otimizada)
        function convertDateToISO(dateString) {
            if (!dateString) return null;
            
            const cached = hyperCache.get(`date_${dateString}`);
            if (cached) return cached;
            
            try {
                let result = null;
                
                if (/^\d{4}-\d{2}-\d{2}$/.test(dateString)) {
                    result = dateString;
                } else {
                    const brazilianMatch = dateString.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})/);
                    if (brazilianMatch) {
                        const [, day, month, year] = brazilianMatch;
                        result = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                    }
                }
                
                if (result) {
                    hyperCache.set(`date_${dateString}`, result);
                }
                
                return result;
                
            } catch (error) {
                console.error('‚ùå Erro na convers√£o de data HYPER:', dateString, error);
                return null;
            }
        }

        // Fun√ß√£o para converter n√∫meros brasileiros (HYPER otimizada)
        function parseBRNumber(value) {
            if (!value) return 0;
            if (typeof value === 'number') return value;
            
            const cached = hyperCache.get(`number_${value}`);
            if (cached !== null) return cached;
            
            const str = value.toString().replace(',', '.');
            const num = parseFloat(str);
            const result = isNaN(num) ? 0 : num;
            
            hyperCache.set(`number_${value}`, result);
            return result;
        }

        // Fun√ß√£o para determinar turno (HYPER otimizada)
        function determineTurno(dateString) {
            if (!dateString) return 'Dia';
            
            const cached = hyperCache.get(`turno_${dateString}`);
            if (cached) return cached;
            
            const match = dateString.match(/(\d{1,2}):(\d{2})/);
            if (!match) return 'Dia';
            
            const hour = parseInt(match[1]);
            let result;
            
            if (hour >= 6 && hour < 12) result = 'Manh√£';
            else if (hour >= 12 && hour < 18) result = 'Tarde';
            else if (hour >= 18 && hour < 24) result = 'Noite';
            else result = 'Madrugada';
            
            hyperCache.set(`turno_${dateString}`, result);
            return result;
        }

        // Fun√ß√£o para extrair hora (HYPER otimizada)
        function extractHour(dateString) {
            if (!dateString) return '';
            
            const cached = hyperCache.get(`hour_${dateString}`);
            if (cached !== null) return cached;
            
            const match = dateString.match(/(\d{1,2}):(\d{2})/);
            const result = match ? `${match[1].padStart(2, '0')}:${match[2]}` : '';
            
            hyperCache.set(`hour_${dateString}`, result);
            return result;
        }

        // Atualizar status de loading
        function updateLoadingStatus(message, progress = null) {
            document.getElementById('loadingStatus').textContent = message;
            if (progress !== null) {
                const progressBar = document.getElementById('loadingProgress');
                progressBar.style.width = progress + '%';
                progressBar.textContent = progress.toFixed(0) + '%';
            }
        }

        // Atualizar m√©tricas de performance HYPER
        function updatePerformanceMetrics() {
            document.getElementById('loadTime').textContent = (performanceMetrics.loadTime / 1000).toFixed(2) + 's';
            document.getElementById('throughput').textContent = performanceMetrics.throughput.toLocaleString('pt-BR');
            document.getElementById('cacheHitRate').textContent = hyperCache.getHitRate() + '%';
            document.getElementById('indexCount').textContent = hyperIndexSystem.getStats().totalIndexes;
            document.getElementById('filterTime').textContent = filterTime + 'ms';
            
            const memoryEstimate = (allData.length * 0.7 / 1024).toFixed(1);
            document.getElementById('memoryUsage').textContent = memoryEstimate + ' KB';
            
            const workerStats = hyperWorkerPool.getStats();
            document.getElementById('workerCount').textContent = `${workerStats.busy}/${workerStats.total}`;
        }

        // Inicializa√ß√£o do dashboard HYPER otimizado
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üî• Iniciando Dashboard HYPER Otimizado...');
            
            updateFPS();
            
            try {
                updateLoadingStatus('Conectando ao Supabase...', 5);
                updateStatus('supabaseStatus', 'success', '‚úÖ Supabase Conectado');
                
                updateLoadingStatus('Inicializando cache HYPER...', 10);
                updateStatus('cacheStatus', 'success', '‚úÖ Cache HYPER Ativo');
                
                updateLoadingStatus('Inicializando pool de workers HYPER...', 15);
                updateStatus('virtualStatus', 'success', '‚úÖ Workers HYPER Ativo');
                
                updateLoadingStatus('Carregando dados HYPER otimizados...', 20);
                updateStatus('dataStatus', 'warning', '‚è≥ Carregando dados...');
                
                await loadDataHyperOptimized();
                
                updateLoadingStatus('Processamento HYPER conclu√≠do!', 100);
                
                performanceMetrics.loadTime = Date.now() - performanceMetrics.startTime;
                performanceMetrics.throughput = Math.round(allData.length / (performanceMetrics.loadTime / 1000));
                performanceMetrics.workerCount = hyperWorkerPool.getStats().total;
                performanceMetrics.indexCount = hyperIndexSystem.getStats().totalIndexes;
                
                updatePerformanceMetrics();
                
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                }, 1000);
                
                console.log('‚úÖ Dashboard HYPER Otimizado inicializado com sucesso!');
                
            } catch (error) {
                console.error('‚ùå Erro na inicializa√ß√£o HYPER:', error);
                updateStatus('supabaseStatus', 'error', '‚ùå Erro de conex√£o');
                updateStatus('dataStatus', 'error', '‚ùå Erro ao carregar');
                updateStatus('cacheStatus', 'error', '‚ùå Cache falhou');
                updateStatus('indexStatus', 'error', '‚ùå √çndices falharam');
                updateStatus('processStatus', 'error', '‚ùå Falha na inicializa√ß√£o');
                updateStatus('virtualStatus', 'error', '‚ùå Workers falharam');
                
                updateLoadingStatus('Erro na inicializa√ß√£o HYPER: ' + error.message, 0);
            }
        });

        // Atualizar indicadores de status
        function updateStatus(elementId, type, text) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `status-indicator ${type}`;
                element.textContent = text;
            }
        }

        // Carregamento HYPER otimizado de dados
        async function loadDataHyperOptimized() {
            console.log('üìä Carregando dados com HYPER otimiza√ß√µes...');
            
            try {
                allData = [];
                let page = 0;
                const pageSize = 8000; // P√°ginas ainda maiores para HYPER
                let hasMore = true;
                let totalLoaded = 0;
                
                updateStatus('dataStatus', 'warning', '‚è≥ Carregando dados...');
                
                const maxConcurrentRequests = 8; // Mais requisi√ß√µes para HYPER
                const activeRequests = [];
                
                while (hasMore) {
                    if (activeRequests.length >= maxConcurrentRequests) {
                        await Promise.race(activeRequests);
                    }
                    
                    const requestPromise = loadDataBatch(page, pageSize);
                    activeRequests.push(requestPromise);
                    
                    requestPromise.then(() => {
                        const index = activeRequests.indexOf(requestPromise);
                        if (index > -1) activeRequests.splice(index, 1);
                    });
                    
                    const { data, error } = await requestPromise;
                    
                    if (error) {
                        console.error('‚ùå Erro ao carregar dados HYPER:', error);
                        throw error;
                    }
                    
                    if (data && data.length > 0) {
                        allData = allData.concat(data);
                        totalLoaded += data.length;
                        
                        console.log(`‚úÖ P√°gina ${page + 1}: ${data.length} registros (Total: ${totalLoaded})`);
                        
                        const progress = Math.min(20 + (page * 1.2), 80);
                        updateLoadingStatus(`Carregando HYPER: ${totalLoaded.toLocaleString('pt-BR')} registros`, progress);
                        updateStatus('dataStatus', 'warning', `‚è≥ ${totalLoaded.toLocaleString('pt-BR')} registros`);
                        
                        hasMore = data.length === pageSize;
                        page++;
                    } else {
                        hasMore = false;
                    }
                }
                
                await Promise.all(activeRequests);
                
                console.log(`‚úÖ TOTAL DE REGISTROS CARREGADOS HYPER: ${allData.length.toLocaleString('pt-BR')}`);
                
                if (allData.length === 0) {
                    updateStatus('dataStatus', 'warning', '‚ö†Ô∏è Sem dados');
                    updateStatus('processStatus', 'warning', '‚ö†Ô∏è Banco vazio');
                    document.getElementById('periodInfo').textContent = 'üìÖ Per√≠odo: Sem dados ¬∑ 0 registros';
                    return;
                }
                
                updateLoadingStatus('Processando dados HYPER em background...', 85);
                
                await processDataHyperOptimized();
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados HYPER:', error);
                updateStatus('dataStatus', 'error', '‚ùå Erro ao carregar');
                throw error;
            }
        }

        // Carregar lote de dados
        async function loadDataBatch(page, pageSize) {
            return await supabase
                .from('vendas_kpi_daily_v2_data')
                .select('*')
                .range(page * pageSize, (page + 1) * pageSize - 1)
                .order('dia', { ascending: true });
        }

        // Processamento HYPER otimizado de dados
        async function processDataHyperOptimized() {
            console.log('‚öôÔ∏è Processando dados com HYPER otimiza√ß√µes...');
            
            try {
                // Usar worker pool para processamento paralelo HYPER
                const chunks = [];
                const chunkSize = Math.ceil(allData.length / hyperWorkerPool.getStats().total);
                
                for (let i = 0; i < allData.length; i += chunkSize) {
                    chunks.push(allData.slice(i, i + chunkSize));
                }
                
                const processedChunks = await Promise.all(
                    chunks.map(async (chunk, index) => {
                        console.log(`üî• Processando chunk HYPER ${index + 1}/${chunks.length}`);
                        
                        const validData = [];
                        let invalidCount = 0;
                        
                        for (const record of chunk) {
                            const isoDate = convertDateToISO(record.dia);
                            
                            if (isoDate) {
                                record.dia = isoDate;
                                record.turno = determineTurno(record.dia);
                                record.hora = extractHour(record.dia);
                                validData.push(record);
                            } else {
                                invalidCount++;
                            }
                        }
                        
                        return { validData, invalidCount };
                    })
                );
                
                allData = [];
                let totalInvalid = 0;
                
                processedChunks.forEach(({ validData, invalidCount }) => {
                    allData = allData.concat(validData);
                    totalInvalid += invalidCount;
                });
                
                filteredData = [...allData];
                
                console.log(`‚úÖ Dados HYPER processados: ${allData.length.toLocaleString('pt-BR')} registros v√°lidos, ${totalInvalid} inv√°lidos`);
                
                updateLoadingStatus('Construindo √≠ndices HYPER...', 90);
                updateStatus('indexStatus', 'warning', '‚è≥ Construindo √≠ndices...');
                
                // Construir √≠ndices HYPER
                hyperIndexSystem.buildIndexes(allData);
                updateStatus('indexStatus', 'success', '‚úÖ √çndices HYPER Ativos');
                
                await calculateDateRangeHyperOptimized();
                await buildFilterOptionsHyperOptimized();
                await calculateKPIsHyperOptimized();
                await updateChartHyperOptimized();
                await initializeVirtualTable();
                
                updateStatus('dataStatus', 'success', `‚úÖ ${allData.length.toLocaleString('pt-BR')} registros`);
                updateStatus('processStatus', 'success', '‚úÖ Processamento HYPER conclu√≠do');
                
                updateOptimizationInfo();
                
            } catch (error) {
                console.error('‚ùå Erro ao processar dados HYPER:', error);
                updateStatus('processStatus', 'error', '‚ùå Erro no processamento HYPER');
                throw error;
            }
        }

        // Calcular per√≠odo dos dados (HYPER otimizado)
        async function calculateDateRangeHyperOptimized() {
            if (allData.length === 0) {
                document.getElementById('periodInfo').textContent = 'üìÖ Per√≠odo: Sem dados ¬∑ 0 registros';
                return;
            }
            
            try {
                minISO = allData[0].dia;
                maxISO = allData[allData.length - 1].dia;
                
                console.log('üìÖ Per√≠odo HYPER calculado:', minISO, '‚Üí', maxISO);
                
                const minFormatted = formatDateBR(minISO);
                const maxFormatted = formatDateBR(maxISO);
                
                document.getElementById('periodInfo').textContent = 
                    `üìÖ Per√≠odo: ${minFormatted} ‚Üí ${maxFormatted} ¬∑ ${allData.length.toLocaleString('pt-BR')} registros HYPER`;
                
                document.getElementById('dataInicial').value = minISO;
                document.getElementById('dataFinal').value = maxISO;
                
            } catch (error) {
                console.error('‚ùå Erro ao calcular per√≠odo HYPER:', error);
                document.getElementById('periodInfo').textContent = 'üìÖ Per√≠odo: Erro ao calcular HYPER ¬∑ 0 registros';
            }
        }

        // Formatar data para exibi√ß√£o brasileira (HYPER otimizada)
        function formatDateBR(isoDate) {
            if (!isoDate) return '';
            
            const cached = hyperCache.get(`format_${isoDate}`);
            if (cached) return cached;
            
            try {
                const [year, month, day] = isoDate.split('-');
                const result = `${day}/${month}/${year}`;
                hyperCache.set(`format_${isoDate}`, result);
                return result;
            } catch (error) {
                console.error('‚ùå Erro ao formatar data HYPER:', isoDate, error);
                return isoDate;
            }
        }

        // Construir op√ß√µes dos filtros (HYPER otimizado)
        async function buildFilterOptionsHyperOptimized() {
            console.log('üîß Construindo op√ß√µes dos filtros com HYPER otimiza√ß√µes...');
            
            try {
                // Usar √≠ndices para construir op√ß√µes mais rapidamente
                const unidades = [...hyperIndexSystem.indexes.get('unidade').keys()].sort();
                
                // Top 10 lojas usando agrega√ß√£o HYPER
                const lojasFaturamento = new Map();
                for (const record of allData) {
                    const loja = record['Nome da loja'];
                    if (loja) {
                        const currentFat = lojasFaturamento.get(loja) || 0;
                        lojasFaturamento.set(loja, currentFat + parseBRNumber(record.fat));
                    }
                }
                
                const topLojas = [...lojasFaturamento.entries()]
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 10)
                    .map(([loja]) => loja);
                
                const canais = [...hyperIndexSystem.indexes.get('Canal de venda').keys()].sort();
                const pagamentos = [...hyperIndexSystem.indexes.get('pagamento').keys()].sort();
                
                buildSelectOptions('filterUnidade', unidades);
                buildSelectOptions('filterLoja', topLojas);
                buildSelectOptions('filterCanal', canais);
                buildSelectOptions('filterPagamento', pagamentos);
                
                console.log('‚úÖ Op√ß√µes dos filtros HYPER constru√≠das');
                
            } catch (error) {
                console.error('‚ùå Erro ao construir filtros HYPER:', error);
            }
        }

        // Construir op√ß√µes de um select
        function buildSelectOptions(selectId, options) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const firstOption = select.querySelector('option');
            select.innerHTML = '';
            if (firstOption) {
                select.appendChild(firstOption);
            }
            
            const fragment = document.createDocumentFragment();
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                fragment.appendChild(optionElement);
            });
            select.appendChild(fragment);
        }

        // Aplicar filtros com HYPER otimiza√ß√µes
        async function applyFilters() {
            console.log('üî• Aplicando filtros com HYPER otimiza√ß√µes...');
            
            const startTime = Date.now();
            
            try {
                const applyBtn = document.getElementById('applyBtn');
                applyBtn.disabled = true;
                applyBtn.textContent = '‚è≥ Processando HYPER...';
                
                const filters = {
                    unidade: document.getElementById('filterUnidade').value,
                    loja: document.getElementById('filterLoja').value,
                    dataInicial: document.getElementById('dataInicial').value,
                    dataFinal: document.getElementById('dataFinal').value,
                    turno: document.getElementById('filterTurno').value,
                    canal: document.getElementById('filterCanal').value,
                    pagamento: document.getElementById('filterPagamento').value,
                    cancelado: document.getElementById('filterCancelado').value
                };
                
                console.log('üìÖ Filtros HYPER aplicados:', filters);
                
                const filterKey = JSON.stringify(filters);
                const cachedResult = hyperCache.get(`filter_${filterKey}`);
                
                if (cachedResult) {
                    console.log('üíæ Usando resultado do cache HYPER');
                    filteredData = cachedResult;
                } else {
                    // Usar √≠ndices HYPER para filtragem ultra-r√°pida
                    const indexedResults = hyperIndexSystem.query(filters);
                    
                    if (indexedResults && allData.length > 20000) {
                        // Usar resultados dos √≠ndices com worker pool
                        filteredData = await hyperWorkerPool.execute('filter', allData, { 
                            filters, 
                            indexes: indexedResults 
                        });
                    } else if (allData.length > 10000) {
                        // Usar worker pool sem √≠ndices
                        filteredData = await hyperWorkerPool.execute('filter', allData, { filters });
                    } else {
                        // Filtragem s√≠ncrona para datasets menores
                        filteredData = allData.filter(record => {
                            if (filters.unidade && record.unidade !== filters.unidade) return false;
                            if (filters.loja && record['Nome da loja'] !== filters.loja) return false;
                            if (filters.dataInicial && record.dia < filters.dataInicial) return false;
                            if (filters.dataFinal && record.dia > filters.dataFinal) return false;
                            if (filters.turno && record.turno !== filters.turno) return false;
                            if (filters.canal && record['Canal de venda'] !== filters.canal) return false;
                            if (filters.pagamento && record.pagamento !== filters.pagamento) return false;
                            if (filters.cancelado !== '') {
                                const isCancelado = record.cancelado === true || record.cancelado === 'true';
                                if (filters.cancelado === 'true' && !isCancelado) return false;
                                if (filters.cancelado === 'false' && isCancelado) return false;
                            }
                            return true;
                        });
                    }
                    
                    hyperCache.set(`filter_${filterKey}`, filteredData);
                }
                
                filterTime = Date.now() - startTime;
                
                console.log(`‚úÖ Filtros HYPER aplicados: ${filteredData.length.toLocaleString('pt-BR')} registros de ${allData.length.toLocaleString('pt-BR')} totais em ${filterTime}ms`);
                
                currentPage = 1;
                
                updateFilteredPeriod();
                await calculateKPIsHyperOptimized();
                await updateChartHyperOptimized();
                await updateVirtualTable();
                
                updatePerformanceMetrics();
                updateOptimizationInfo();
                
            } catch (error) {
                console.error('‚ùå Erro ao aplicar filtros HYPER:', error);
            } finally {
                const applyBtn = document.getElementById('applyBtn');
                applyBtn.disabled = false;
                applyBtn.textContent = 'üîç Aplicar Filtros';
            }
        }

        // Atualizar per√≠odo filtrado
        function updateFilteredPeriod() {
            if (filteredData.length === 0) {
                document.getElementById('periodInfo').textContent = 'üìÖ Per√≠odo: Sem dados ¬∑ 0 registros';
                return;
            }
            
            const dates = filteredData.map(record => record.dia).filter(date => date);
            dates.sort();
            
            const minDate = dates[0];
            const maxDate = dates[dates.length - 1];
            
            const minFormatted = formatDateBR(minDate);
            const maxFormatted = formatDateBR(maxDate);
            
            document.getElementById('periodInfo').textContent = 
                `üìÖ Per√≠odo: ${minFormatted} ‚Üí ${maxFormatted} ¬∑ ${filteredData.length.toLocaleString('pt-BR')} registros HYPER`;
        }

        // Limpar filtros
        function clearFilters() {
            console.log('üîÑ Limpando filtros HYPER...');
            
            document.getElementById('filterUnidade').value = '';
            document.getElementById('filterLoja').value = '';
            document.getElementById('dataInicial').value = minISO;
            document.getElementById('dataFinal').value = maxISO;
            document.getElementById('filterPeriodo').value = '';
            document.getElementById('filterTurno').value = '';
            document.getElementById('filterCanal').value = '';
            document.getElementById('filterPagamento').value = '';
            document.getElementById('filterCancelado').value = '';
            
            applyFilters();
        }

        // Calcular KPIs com HYPER otimiza√ß√µes
        async function calculateKPIsHyperOptimized() {
            console.log('üìä Calculando KPIs com HYPER otimiza√ß√µes...');
            
            try {
                if (filteredData.length === 0) {
                    const kpiElements = ['kpiPedidos', 'kpiTicketMedio', 'kpiFaturamento', 'kpiFaturamentoDia', 
                                       'kpiIncentivos', 'kpiIncentivosPercent', 'kpiFrete', 'kpiFaturamentoLiquido'];
                    
                    kpiElements.forEach(id => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.textContent = id.includes('Percent') ? '-%' : (id.includes('kpi') && !id.includes('Pedidos') ? 'R$ -' : '-');
                        }
                    });
                    
                    ['compPedidos', 'compTicketMedio', 'compFaturamento', 'compFaturamentoDia', 
                     'compIncentivos', 'compIncentivosPercent', 'compFrete', 'compFaturamentoLiquido'].forEach(id => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.innerHTML = '<span class="comparison-neutral">‚Äî N/A</span>';
                        }
                    });
                    
                    return;
                }
                
                let kpis;
                if (filteredData.length > 2000) {
                    kpis = await hyperWorkerPool.execute('aggregate', filteredData);
                } else {
                    const pedidos = filteredData.length;
                    const faturamento = filteredData.reduce((sum, record) => sum + parseBRNumber(record.fat), 0);
                    const desconto = filteredData.reduce((sum, record) => sum + parseBRNumber(record.des), 0);
                    const frete = filteredData.reduce((sum, record) => sum + parseBRNumber(record.fre), 0);
                    
                    kpis = {
                        pedidos,
                        faturamento,
                        desconto,
                        frete,
                        ticketMedio: pedidos > 0 ? faturamento / pedidos : 0,
                        faturamentoLiquido: faturamento - desconto,
                        incentivosPercent: faturamento > 0 ? (desconto / faturamento) * 100 : 0
                    };
                }
                
                const diasUnicos = [...new Set(filteredData.map(record => record.dia))].length;
                const faturamentoDia = diasUnicos > 0 ? kpis.faturamento / diasUnicos : 0;
                
                document.getElementById('kpiPedidos').textContent = kpis.pedidos.toLocaleString('pt-BR');
                document.getElementById('kpiTicketMedio').textContent = 'R$ ' + kpis.ticketMedio.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                document.getElementById('kpiFaturamento').textContent = 'R$ ' + kpis.faturamento.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                document.getElementById('kpiFaturamentoDia').textContent = 'R$ ' + faturamentoDia.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                document.getElementById('kpiIncentivos').textContent = 'R$ ' + kpis.desconto.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                document.getElementById('kpiIncentivosPercent').textContent = kpis.incentivosPercent.toFixed(1) + '%';
                document.getElementById('kpiFrete').textContent = 'R$ ' + kpis.frete.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                document.getElementById('kpiFaturamentoLiquido').textContent = 'R$ ' + kpis.faturamentoLiquido.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                
                console.log('‚úÖ KPIs HYPER calculados:', kpis);
                
                updateComparisons();
                
            } catch (error) {
                console.error('‚ùå Erro ao calcular KPIs HYPER:', error);
            }
        }

        // Atualizar comparativos
        function updateComparisons() {
            ['compPedidos', 'compTicketMedio', 'compFaturamento', 'compFaturamentoDia', 
             'compIncentivos', 'compIncentivosPercent', 'compFrete', 'compFaturamentoLiquido'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.innerHTML = '<span class="comparison-neutral">‚Äî N/A</span>';
                }
            });
        }

        // Atualizar gr√°fico com HYPER otimiza√ß√µes
        async function updateChartHyperOptimized() {
            console.log('üìà Atualizando gr√°fico com HYPER otimiza√ß√µes...');
            
            try {
                const ctx = document.getElementById('revenueChart').getContext('2d');
                
                if (chart) {
                    chart.destroy();
                }
                
                if (filteredData.length === 0) {
                    chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [{
                                label: 'Receita Di√°ria',
                                data: [],
                                borderColor: 'rgba(102, 126, 234, 1)',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: getChartOptionsHyper()
                    });
                    return;
                }
                
                let dailyRevenue;
                if (filteredData.length > 1000) {
                    dailyRevenue = await hyperWorkerPool.execute('groupByDate', filteredData);
                } else {
                    dailyRevenue = {};
                    filteredData.forEach(record => {
                        const day = record.dia;
                        if (day) {
                            dailyRevenue[day] = (dailyRevenue[day] || 0) + parseBRNumber(record.fat);
                        }
                    });
                }
                
                const sortedDays = Object.keys(dailyRevenue).sort();
                const revenues = sortedDays.map(day => dailyRevenue[day]);
                const labels = sortedDays.map(day => formatDateBR(day));
                
                // HYPER Otimiza√ß√£o: Reduzir pontos do gr√°fico se necess√°rio
                let finalLabels = labels;
                let finalRevenues = revenues;
                
                if (labels.length > 300) {
                    const step = Math.ceil(labels.length / 300);
                    finalLabels = labels.filter((_, index) => index % step === 0);
                    finalRevenues = revenues.filter((_, index) => index % step === 0);
                }
                
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: finalLabels,
                        datasets: [{
                            label: 'Receita Di√°ria',
                            data: finalRevenues,
                            borderColor: 'rgba(102, 126, 234, 1)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: finalLabels.length > 150 ? 0 : 1,
                            pointHoverRadius: 3
                        }]
                    },
                    options: getChartOptionsHyper()
                });
                
                console.log('‚úÖ Gr√°fico HYPER atualizado');
                
            } catch (error) {
                console.error('‚ùå Erro ao atualizar gr√°fico HYPER:', error);
            }
        }

        // Op√ß√µes do gr√°fico HYPER otimizadas
        function getChartOptionsHyper() {
            return {
                responsive: true,
                animation: {
                    duration: 300 // Anima√ß√£o ultra-r√°pida para HYPER
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                plugins: {
                    legend: {
                        labels: { color: 'white' }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        titleColor: 'white',
                        bodyColor: 'white',
                        borderColor: 'rgba(255,255,255,0.3)',
                        borderWidth: 1
                    }
                },
                scales: {
                    x: { 
                        ticks: { 
                            color: 'white',
                            maxTicksLimit: 20
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    y: { 
                        ticks: { 
                            color: 'white',
                            callback: function(value) {
                                return 'R$ ' + value.toLocaleString('pt-BR');
                            }
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    }
                }
            };
        }

        // Inicializar tabela virtual
        async function initializeVirtualTable() {
            console.log('üìã Inicializando tabela virtual HYPER...');
            
            totalPages = Math.ceil(filteredData.length / pageSize);
            await updateVirtualTable();
        }

        // Atualizar tabela virtual
        async function updateVirtualTable() {
            try {
                if (filteredData.length === 0) {
                    document.getElementById('virtualTableBody').innerHTML = 
                        '<div style="padding: 20px; text-align: center; color: rgba(255,255,255,0.6);">Nenhum dado encontrado</div>';
                    document.getElementById('tableInfo').textContent = '0 registros';
                    document.getElementById('paginationInfo').textContent = 'P√°gina 0 de 0';
                    return;
                }

                let pageData;
                if (filteredData.length > 5000) {
                    const result = await hyperWorkerPool.execute('paginate', filteredData, { page: currentPage, size: pageSize });
                    pageData = result.data;
                    totalPages = result.pages;
                } else {
                    const start = (currentPage - 1) * pageSize;
                    const end = start + pageSize;
                    pageData = filteredData.slice(start, end);
                    totalPages = Math.ceil(filteredData.length / pageSize);
                }

                const tableBody = document.getElementById('virtualTableBody');
                const fragment = document.createDocumentFragment();

                pageData.forEach(record => {
                    const row = document.createElement('div');
                    row.className = 'table-row';
                    
                    row.innerHTML = `
                        <div class="table-cell">${formatDateBR(record.dia) || '-'}</div>
                        <div class="table-cell">${record['Nome da loja'] || '-'}</div>
                        <div class="table-cell">R$ ${parseBRNumber(record.fat).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</div>
                        <div class="table-cell">R$ ${parseBRNumber(record.des).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</div>
                        <div class="table-cell">${record.turno || '-'}</div>
                    `;
                    
                    fragment.appendChild(row);
                });

                tableBody.innerHTML = '';
                tableBody.appendChild(fragment);

                const start = (currentPage - 1) * pageSize + 1;
                const end = Math.min(currentPage * pageSize, filteredData.length);
                
                document.getElementById('tableInfo').textContent = 
                    `${start}-${end} de ${filteredData.length.toLocaleString('pt-BR')} registros`;
                
                document.getElementById('paginationInfo').textContent = 
                    `P√°gina ${currentPage} de ${totalPages}`;

                document.getElementById('prevBtn').disabled = currentPage <= 1;
                document.getElementById('nextBtn').disabled = currentPage >= totalPages;

                console.log(`‚úÖ Tabela virtual HYPER atualizada: p√°gina ${currentPage}/${totalPages}`);

            } catch (error) {
                console.error('‚ùå Erro ao atualizar tabela virtual HYPER:', error);
            }
        }

        // Navega√ß√£o da tabela virtual
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                updateVirtualTable();
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                updateVirtualTable();
            }
        }

        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSize').value);
            currentPage = 1;
            updateVirtualTable();
        }

        // Reconstruir √≠ndices HYPER
        function rebuildIndexes() {
            console.log('üî• Reconstruindo √≠ndices HYPER...');
            
            updateStatus('indexStatus', 'warning', '‚è≥ Reconstruindo...');
            
            setTimeout(() => {
                hyperIndexSystem.buildIndexes(allData);
                updateStatus('indexStatus', 'success', '‚úÖ √çndices HYPER Reconstru√≠dos');
                updatePerformanceMetrics();
                updateOptimizationInfo();
                console.log('‚úÖ √çndices HYPER reconstru√≠dos');
            }, 100);
        }

        // Otimizar mem√≥ria HYPER
        function optimizeMemory() {
            console.log('üî• Otimizando mem√≥ria HYPER...');
            
            hyperCache.optimize();
            
            if (window.gc) {
                window.gc();
            }
            
            updatePerformanceMetrics();
            updateOptimizationInfo();
            
            console.log('‚úÖ Mem√≥ria HYPER otimizada');
        }

        // Limpar cache HYPER
        function clearCache() {
            hyperCache.clear();
            updateOptimizationInfo();
            updatePerformanceMetrics();
            console.log('üóëÔ∏è Cache HYPER limpo');
        }

        // Atualizar informa√ß√µes de otimiza√ß√£o HYPER
        function updateOptimizationInfo() {
            const cacheSize = hyperCache.getSize();
            const hitRate = hyperCache.getHitRate();
            const workerStats = hyperWorkerPool.getStats();
            const indexStats = hyperIndexSystem.getStats();
            
            document.getElementById('optimizationInfo').textContent = 
                `üî• Sistema HYPER: Cache ${cacheSize} (${hitRate}% hit) ¬∑ Workers ${workerStats.busy}/${workerStats.total} ¬∑ √çndices ${indexStats.totalIndexes} ¬∑ FPS ${fpsCounter} ¬∑ Filtro ${filterTime}ms`;
        }

        // Fun√ß√£o de debug HYPER
        function debugInfo() {
            console.log('üî• === DEBUG INFO HYPER OTIMIZADO ===');
            console.log('üìä Total de registros:', allData.length.toLocaleString('pt-BR'));
            console.log('üîç Registros filtrados:', filteredData.length.toLocaleString('pt-BR'));
            console.log('üìÖ Per√≠odo:', minISO, '‚Üí', maxISO);
            console.log('üíæ Cache HYPER:', hyperCache.getSize(), 'entradas,', hyperCache.getHitRate(), '% hit rate');
            console.log('üîß Workers HYPER:', hyperWorkerPool.getStats());
            console.log('üî• √çndices HYPER:', hyperIndexSystem.getStats());
            console.log('‚ö° Performance HYPER:', performanceMetrics);
            console.log('üß† Mem√≥ria estimada:', (allData.length * 0.7 / 1024).toFixed(1), 'KB');
            console.log('üìã Pagina√ß√£o:', `P√°gina ${currentPage}/${totalPages}, ${pageSize} por p√°gina`);
            console.log('üéØ FPS:', fpsCounter);
            console.log('‚è±Ô∏è Tempo de filtro:', filterTime, 'ms');
            
            if (filteredData.length > 0) {
                console.log('üìã Amostra de dados filtrados:', filteredData.slice(0, 3));
                
                const testDate = '2025-08-10';
                const testData = filteredData.filter(record => record.dia === testDate);
                console.log(`üéØ Dados para ${testDate}:`, testData.length, 'registros');
                
                if (testData.length > 0) {
                    const totalPedidos = testData.length;
                    const totalFaturamento = testData.reduce((sum, record) => sum + parseBRNumber(record.fat), 0);
                    const totalDesconto = testData.reduce((sum, record) => sum + parseBRNumber(record.des), 0);
                    console.log(`üìä ${testDate} - Pedidos: ${totalPedidos}, Faturamento: R$ ${totalFaturamento.toFixed(2)}, Desconto: R$ ${totalDesconto.toFixed(2)}`);
                }
            }
            
            console.log('üî• === FIM DEBUG HYPER OTIMIZADO ===');
        }
    </script>
</body>
</html>

