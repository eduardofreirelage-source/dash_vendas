-- 1) Contagem e limites de data
SELECT COUNT(*) AS linhas FROM public.vendas_kpi_daily_v2_data;
SELECT MIN(dia) AS min_dia, MAX(dia) AS max_dia FROM public.vendas_kpi_daily_v2_data;

-- 2) Unidades existentes (e volume)
SELECT unidade, COUNT(*) AS linhas
FROM public.vendas_kpi_daily_v2_data
GROUP BY 1
ORDER BY 2 DESC;

-- 3) Top 20 lojas
SELECT "Nome da loja", COUNT(*) AS linhas, SUM(fat) AS fat
FROM public.vendas_kpi_daily_v2_data
GROUP BY 1
ORDER BY 3 DESC
LIMIT 20;

-- 4) Canais de venda e pagamentos
SELECT "Canal de venda", COUNT(*) AS linhas FROM public.vendas_kpi_daily_v2_data GROUP BY 1 ORDER BY 2 DESC;
SELECT pagamento, COUNT(*) AS linhas FROM public.vendas_kpi_daily_v2_data GROUP BY 1 ORDER BY 2 DESC;

-- 5) Nulos / vazios nas colunas que alimentam os filtros
SELECT
  SUM(CASE WHEN unidade IS NULL OR TRIM(unidade)='' THEN 1 ELSE 0 END) AS unidade_vazios,
  SUM(CASE WHEN "Nome da loja" IS NULL OR TRIM("Nome da loja")='' THEN 1 ELSE 0 END) AS loja_vazios,
  SUM(CASE WHEN "Canal de venda" IS NULL OR TRIM("Canal de venda")='' THEN 1 ELSE 0 END) AS canal_vazios,
  SUM(CASE WHEN pagamento IS NULL OR TRIM(pagamento)='' THEN 1 ELSE 0 END) AS pagamento_vazios
FROM public.vendas_kpi_daily_v2_data;

-- 6) Amostra do período recente (ajuste datas conforme necessário)
SELECT dia, SUM(pedidos) AS pedidos, SUM(fat) AS fat
FROM public.vendas_kpi_daily_v2_data
WHERE dia BETWEEN (CURRENT_DATE - INTERVAL '30 day')::date AND CURRENT_DATE
GROUP BY 1
ORDER BY 1;
