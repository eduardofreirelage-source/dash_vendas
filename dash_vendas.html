<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Preview — Dashboard Executivo (v10) — Layout focado em decisão</title>
  <style>
    :root{
      --bg:#f7f7fa; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb;
      --wine:#7b1e3a; --wine-2:#8c2947; --chip:#fef2f2; --ok:#0b5d47; --down:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font:11px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
    .wrap{display:flex;min-height:100vh}

    /* FILTERS (discreto, recolhível) */
    .filters{position:sticky;top:0;align-self:flex-start;width:272px;padding:14px;background:var(--card);border-right:1px solid var(--line);height:100vh;overflow:auto}
    .filters h3{margin:0 0 10px 0;font-size:14px}
    /* chips como controle segmentado responsivo */
    .chips{display:flex;flex-wrap:wrap;gap:6px} /* legacy, unused */
    .chip{padding:6px 8px;border:1px solid #efd5db;border-radius:999px;background:var(--chip);cursor:pointer;text-align:center;font-weight:700;color:var(--wine);white-space:nowrap;font-size:10.5px}
    .chip.active{background:var(--wine);color:#fff;border-color:var(--wine)}
    .msel, input[type="date"]{width:100%;padding:8px 10px;border:1px solid var(--line);border-radius:6px;background:#fff;min-height:36px}
    .hr{height:1px;background:var(--line);margin:14px 0}
    .filter-toggle{display:none}

    /* MAIN HEADER + LAYOUT */
    .main{flex:1;min-width:0;display:flex;flex-direction:column}
    .top{position:sticky;top:0;z-index:10;background:linear-gradient(#fff,#fff00),var(--card);background-size:100% 64px,auto;background-repeat:no-repeat;padding:10px 14px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand h1{display:none}
    .tabs{display:flex;gap:6px;border:0;background:transparent}
    .tabs button{padding:6px 8px;border:0;background:transparent;font-weight:700;color:#334155;cursor:pointer;border-radius:8px;position:relative}
    .tabs button.active{background:transparent;color:var(--wine)} .tabs button.active::after{content:"";position:absolute;left:6px;right:6px;bottom:-8px;height:3px;border-radius:2px;background:var(--wine)}

    /* INSIGHTS — agora rodapé colado ao conteúdo */
    .insights{padding:12px 16px;background:#fff}
    .insights-band{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .insight-pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid var(--line);background:#f6f7fb}
    .insight-pill.up{background:#f2f8f6;border-color:#d5e9e2;color:var(--ok)}
    .insight-pill.down{background:#fcf7f9;border-color:#f0d7df;color:var(--wine)}
    .insight-pill.flat{background:#f6f7fb;border-color:#e5e7eb;color:#475569}
    .insight-pill .ins-t{font-weight:800}
    .insight-pill .ins-sub{font-size:11px;color:var(--muted)}
    .insight-pill .ins-badge{margin-left:6px;font-weight:800}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:5px 9px;border-radius:999px;border:1px solid var(--line);font-weight:600}
    .pill .dot{width:8px;height:8px;border-radius:50%;background:var(--wine)} .dot.up{background:var(--ok)} .dot.flat{background:#94a3b8} .dot.down{background:var(--wine)}

    /* GRID DECISÃO */
    .section{order:2;padding:16px}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px}
    .kpi{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:10px;cursor:pointer;transition:.2s;position:relative;cursor:pointer;transition:.2s;position:relative}
    .kpi:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(0,0,0,.05)}
    .kpi.active{outline:3px solid rgba(123,30,58,.12);border-color:var(--wine)}
    .kpi h4{margin:0 0 6px 0;color:var(--muted);font-size:12px;display:flex;align-items:center;gap:6px;padding-right:72px}
    .kpi .val{font-size:24px;font-weight:500;letter-spacing:-.5px}
    .delta{display:inline-flex;gap:4px;align-items:center;padding:2px 8px;border-radius:999px;border:1px solid rgba(148,163,184,.35);background:rgba(148,163,184,.15);font-size:11px;font-weight:800;color:#475569;position:absolute;top:18px;right:22px}
    .delta.up{background:rgba(11,93,71,.14);border-color:rgba(11,93,71,.32);color:var(--ok)}
    .delta.down{background:rgba(123,30,58,.10);border-color:rgba(123,30,58,.25);color:var(--wine)}

    .panel{display:grid;grid-template-columns:1fr 260px;gap:12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:10px;display:flex;flex-direction:column;min-height:272px}
    .card .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .title{font-weight:700}
    .seg{display:inline-flex;border:1px solid var(--line);border-radius:8px;overflow:hidden}
    .seg button{padding:5px 9px;border:0;background:#fff;font-weight:700;color:#475569;cursor:pointer}
    .seg button.active{background:var(--wine);color:#fff}
    .chart{flex:1;border:1px dashed #d8dbe2;border-radius:10px;display:flex;align-items:center;justify-content:center}
    .chart .sk{width:100%;height:100%}
    .side{display:flex;flex-direction:column;gap:10px;padding-left:12px;padding-right:2px}

    /* KPI lateral */
    .mini{min-height:112px;position:relative;display:grid;grid-template-rows:auto auto auto;row-gap:4px}
    .mini h4{margin:0 0 6px 0;color:var(--muted);font-size:12px;display:flex;align-items:center;gap:6px;padding-right:72px}
    .mini .val{font-size:20px;font-weight:500;margin:4px 0 2px}
    .mini .head{position:relative;display:flex;align-items:center;justify-content:space-between;margin-top:8px}
    .mini .delta{position:absolute;top:18px;right:22px}

    /* GRID DIAGNÓSTICO */
    .subgrid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .donut{position:relative}
    .center-badge{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:#fff;border:1px solid var(--line);border-radius:999px;padding:4px 10px;font-weight:800}

    /* RESPONSIVO */
    @media (max-width:1200px){
      .filters{position:fixed;left:-320px;transition:transform .25s ease;transform:translateX(-100%);box-shadow:0 12px 32px rgba(0,0,0,.12)}
      body.show-filters .filters{transform:translateX(320px)}
      .filter-toggle{display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;border:1px solid var(--line);background:#fff}
      .panel{grid-template-columns:1fr}
      .kpis{grid-template-columns:repeat(2,1fr)}
      .subgrid{grid-template-columns:1fr}
    }
  .seg-chips{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
    .seg-chips .chip{width:100%;text-align:center}
  .date-grid{display:grid;grid-template-columns:1fr;gap:10px;margin-bottom:12px}
  .insights-tiles{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    .insight-tile{display:grid;grid-template-columns:auto 1fr auto;grid-template-rows:auto auto auto;gap:6px 10px;padding:12px 14px;background:#fff;border:0;border-radius:12px;align-items:center;box-shadow:0 6px 16px rgba(0,0,0,.06)}
    .insight-tile.up{background:rgba(11,93,71,.06)}
    .insight-tile.down{background:rgba(123,30,58,.06)}
    .insight-tile.flat{background:#f6f7fb}
    .tile-main{grid-column:1 / span 2;display:flex;align-items:baseline;gap:8px}
    .tile-number{font-size:20px;font-weight:800;letter-spacing:-.2px}
    .tile-sub{font-size:11px;color:var(--muted)}
    .tile-spark{grid-column:3 / 4;grid-row:1 / span 2;width:100px;height:28px}
    .tile-meta{grid-column:1 / span 3;display:flex;gap:8px;flex-wrap:wrap}
    .meta{font-size:11px;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:#f8fafc}
  .card.mini:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(0,0,0,.05)}
  .ai-badge{margin-left:6px;font-size:10px;font-weight:900;letter-spacing:.6px;padding:2px 6px;border-radius:6px;border:1px solid var(--line);background:#fff;color:#111827}
    .tile-action{grid-column:1 / span 3;background:#fff;border:1px solid var(--line);border-radius:10px;padding:8px 10px}
    .tile-action.risk{background:#fff4f6;border-color:#f3d1da}
    .action-title{font-weight:800;margin-bottom:6px;color:#111827}
    .action-list{margin:0 0 6px 18px;padding:0}
    .action-list li{margin:2px 0}
    .action-impact{font-size:11px;color:#334155;font-weight:800}
    .action-impact.bad{color:var(--wine)}
  .diag-grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:8px}
    .diag-card{background:#fff;border:0;border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:12px 14px;display:grid;grid-template-columns:260px 1fr 260px;align-items:center;column-gap:12px;row-gap:4px}
    .diag-head{display:flex;align-items:center;justify-content:space-between;gap:8px;grid-column:1}
    .diag-head h5{margin:0;font-size:12px;color:#334155}
    .diag-main{display:flex;align-items:center;justify-content:flex-start;gap:10px;grid-column:1}
    .diag-number{font-size:22px;font-weight:800;letter-spacing:-.2px}
    .diag-spark{width:56px;height:16px;opacity:.55} .diag-spark path{stroke-opacity:.5;stroke-width:1.25} 
    .diag-meta{display:flex;gap:8px;flex-wrap:wrap;grid-column:3}
    .diag-list{margin:0 0 0 16px;padding:0;grid-column:2}
    .diag-list li{margin:2px 0}
  .diag-list li strong{color:#111827}
  .diag-kpi{gap:12px}
    .diag-row{display:grid;grid-template-columns:280px 1fr 320px;align-items:start;gap:14px;background:#fff;border-radius:14px;box-shadow:0 8px 20px rgba(0,0,0,.06);padding:14px 16px;border-left:4px solid transparent}
    .diag-row.up{border-left-color:var(--ok)}
    .diag-row.down{border-left-color:var(--wine)}
    .snap h5{margin:0;color:#334155;font-size:12px;display:inline-flex;align-items:center;gap:8px}
    .snap .delta{position:static;margin-left:8px}
    .snap-val{font-size:22px;font-weight:800;letter-spacing:-.2px;margin-top:6px}
    .snap-sub{font-size:11px;color:var(--muted);margin-top:2px}
    .drivers{display:grid;grid-template-columns:1fr 84px;column-gap:12px;row-gap:6px;align-items:center}
    .drv{display:contents}
    .drv-label{font-weight:700;color:#334155}
    .bar{height:6px;background:#eef0f4;border-radius:999px;overflow:hidden}
    .bar i{display:block;height:100%;background:var(--wine);opacity:.55}
    .drv.up .bar i{background:var(--ok);opacity:.65}
    .drv .drv-delta{justify-self:end;font-size:11px;font-weight:800;color:#334155}
    .drivers .chips{grid-column:1 / -1;display:flex;gap:8px;flex-wrap:wrap;margin-top:4px}
    .actions{display:flex;flex-direction:column;gap:6px}
    .actions .act-title{font-weight:800;color:#111827}
    .actions .act-list{margin:0 0 0 18px;padding:0}
    .impact-chip{align-self:flex-start;font-size:11px;font-weight:800;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:#f8fafc;color:#334155}
    @media (max-width:1200px){.diag-row{grid-template-columns:1fr;}}
  .dx-grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:6px;place-items:center}
  .dx-card{display:grid;grid-template-columns:220px 1fr 220px;align-items:center;gap:10px;background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px 14px;max-width:900px;width:100%;min-height:132px}
  .dx-card.up{}
  .dx-card.down{}
  .dx-head{display:flex;align-items:center;justify-content:space-between;margin:0 0 4px 0}
  .dx-head h5{margin:0;color:#334155;font-size:12px;font-weight:700;display:inline-flex;align-items:center;gap:6px} .dx-card.up .dx-head h5::before{content:"";width:6px;height:6px;border-radius:999px;background:var(--ok)} .dx-card.down .dx-head h5::before{content:"";width:6px;height:6px;border-radius:999px;background:var(--wine)}
  .dx-val{font-size:18px;font-weight:800;letter-spacing:-.2px;margin-top:2px}
  .dx-prev{font-size:10px;color:var(--muted);margin-top:0}
  .dx-bullets{margin:0;padding-left:12px}
  .dx-bullets li{margin:1px 0}
  .dx-action h6{margin:0 0 4px 0;font-weight:700;color:#334155;font-size:11px}
  .dx-impact{display:inline-flex;align-items:center;gap:4px;padding:0;border:0;border-radius:0;font-size:11px;font-weight:700;color:#334155;background:transparent}
.dx-line{display:flex;flex-wrap:nowrap;gap:10px;align-items:center;font-size:11px;color:#334155;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dx-line .lbl{font-weight:700;color:#334155}
.dx-sep{opacity:.4}
.dx-next{display:flex;flex-direction:column;align-items:flex-end;gap:2px}
.dx-next .act{font-size:11px;font-weight:700;color:#111827;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dx-next .impact{font-size:11px;color:#334155}
.dx-card>:nth-child(2){border-left:1px solid var(--line);padding-left:12px}
.dx-card>:nth-child(3){border-left:1px solid var(--line);padding-left:12px}
.kpi-picker{display:flex;gap:8px;flex-wrap:wrap;margin:4px 0 10px}
.kpi-pill{padding:7px 10px;border:1px solid var(--line);border-radius:10px;background:#fff;font-weight:700;color:#334155;cursor:pointer}
.kpi-pill.active{background:var(--wine);color:#fff;border-color:var(--wine)}
.diag-hero{display:flex;align-items:baseline;gap:12px;margin:2px 0 10px}
.diag-hero h4{margin:0;font-size:14px;color:#334155}
.diag-hero .val{font-size:28px;font-weight:600;letter-spacing:-.6px}
.diag-hero .delta{position:static}
.diag-hero .prev{font-size:11px;color:var(--muted)}
.diag-detail{display:grid;grid-template-columns:1.2fr 1fr 1fr;gap:12px}
.diag-card2{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px 14px;min-height:240px;display:flex;flex-direction:column}
.ins-list{margin:0;padding:0;display:flex;flex-direction:column;gap:8px}
.ins-card{border:1px solid var(--line);border-radius:10px;padding:8px 10px;display:grid;grid-template-columns:auto 1fr;gap:8px;align-items:start;background:#f8fafc}
.ins-card.up{background:#f2f8f6}
.ins-card.down{background:#fcf7f9}
.ins-card .dot{width:10px;height:10px;border-radius:50%;margin-top:4px;background:#94a3b8}
.ins-card.up .dot{background:var(--ok)}
.ins-card.down .dot{background:var(--wine)}
.ins-title{font-weight:800}
.ins-sub{color:#334155;font-size:11px}
.ins-action{font-size:11px;color:#334155;margin-top:2px}
.ins-action strong{color:#111827}
.proj-controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.kpi-quick{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:6px}
.mini-metric{border:1px solid var(--line);border-radius:10px;padding:8px 10px}
.mini-metric .lbl{font-size:11px;color:#334155}
.mini-metric .big{font-size:18px;font-weight:800;letter-spacing:-.2px}
.hero-card{padding:16px 18px;min-height:180px}
.hero-grid{display:grid;grid-template-columns:1.1fr 0.9fr 1.2fr;gap:16px;align-items:center}
.hero-snap h4{margin:0;font-size:14px;color:#334155}
.hero-snap .delta{position:static;margin-left:6px}
.hero-snap .val{font-size:32px;font-weight:600;letter-spacing:-.6px}
.hero-snap .prev{font-size:11px;color:var(--muted)}
.hero-quick{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.hero-quick .mini-metric{border:1px solid var(--line);border-radius:10px;padding:8px 10px}
.hero-quick .lbl{font-size:11px;color:#334155}
.hero-quick .big{font-size:18px;font-weight:800;letter-spacing:-.2px}
.hero-controls{display:flex;gap:8px;margin-top:6px;flex-wrap:wrap}
.mini-line{height:120px;border:1px dashed #d8dbe2;border-radius:10px;display:flex;align-items:center;justify-content:center}
.diag-detail .charts{grid-column:2;grid-row:1 / span 2}
.hero-split{display:grid;grid-template-columns:1fr 1fr;gap:12px;min-height:220px}
.hero-info{display:flex;flex-direction:column;gap:6px}
.hero-viz{height:180px}
.proj-grid{display:grid;grid-template-columns:1.2fr 0.8fr;gap:10px;align-items:start}
.proj-grid .kpi-quick{grid-template-columns:1fr;gap:6px}
.diag-card2.tall{min-height:300px}
.hero-viz{display:block}
.hero-viz-grid{display:flex;flex-direction:column;gap:8px}
.hero-viz-grid .big{height:180px}
.hero-viz-grid .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.diag-card2.tall{min-height:340px}
.dragging{opacity:.6;outline:2px dashed var(--wine)}
.edit-mode .box{outline:1px dashed var(--wine);position:relative;cursor:grab}
.edit-mode .box .resize-br{position:absolute;right:6px;bottom:6px;width:12px;height:12px;background:var(--wine);opacity:.5;border-radius:2px;cursor:nwse-resize}
.edit-mode .box .resize-b{position:absolute;left:20%;right:20%;bottom:0;height:6px;background:rgba(123,30,58,.25);border-radius:3px;cursor:ns-resize}
.edit-mode .box .resize-r{position:absolute;top:20%;bottom:20%;right:0;width:6px;background:rgba(123,30,58,.25);border-radius:3px;cursor:ew-resize}
.edit-mode .box.dragging{opacity:.6}
.nest-hover{box-shadow:inset 0 0 0 3px rgba(123,30,58,.25)}
.diag-layout{display:grid;grid-template-columns:1.2fr 1fr 1fr;gap:12px}
.diag-layout .hero{grid-column:1 / -1}
.edit-mode .subbox{outline:1px dotted rgba(123,30,58,.6);position:relative}
.edit-mode .subbox .resize-br{position:absolute;right:4px;bottom:4px;width:10px;height:10px;background:var(--wine);opacity:.4;border-radius:2px;cursor:nwse-resize}
.edit-mode .subbox .resize-b{position:absolute;left:20%;right:20%;bottom:0;height:5px;background:rgba(123,30,58,.25);border-radius:3px;cursor:ns-resize}
.edit-mode .subbox .resize-r{position:absolute;top:20%;bottom:20%;right:0;width:5px;background:rgba(123,30,58,.25);border-radius:3px;cursor:ew-resize}
.drop-hint{box-shadow:inset 0 0 0 3px rgba(123,30,58,.25)}
.edit-tools{position:absolute;top:6px;right:6px;display:flex;gap:6px;z-index:2}
.edit-mode .edit-tools .btn{padding:3px 6px;border:1px solid var(--line);border-radius:6px;background:#fff;font-weight:700;font-size:10px;cursor:pointer}
.edit-mode .edit-tools .btn:hover{background:#f8fafc}
.edit-mode .diag-layout{grid-template-columns:repeat(12,minmax(0,1fr))}
</style>
</head>
<body>
  <div class="wrap">
    <aside class="filters">
      <h3>Filtros</h3>
      <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Período</div>
      <div class="date-grid">
        <input type="date"/>
        <input type="date"/>
      </div>
      <div class="seg-chips" style="margin-bottom:10px">
        <button class="chip">7</button><button class="chip">15</button><button class="chip active">30</button>
        <button class="chip">60</button><button class="chip">90</button><button class="chip">120</button>
      </div>
      <div class="hr"></div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Unidade</div>
      <div class="msel" style="margin-bottom:8px">Todas</div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Loja</div>
      <div class="msel" style="margin-bottom:8px">Todas</div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Turno</div>
      <div class="msel" style="margin-bottom:8px">Todos</div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Canal</div>
      <div class="msel" style="margin-bottom:8px">Todos</div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Pagamento</div>
      <div class="msel" style="margin-bottom:8px">Todos</div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Cancelado</div>
      <div class="msel" style="margin-bottom:8px">Não</div>
    </aside>

    <main class="main">
      <div class="top">
        <div class="brand">
          <button class="filter-toggle" onclick="document.body.classList.toggle('show-filters')">☰</button>
          <div class="tabs" id="tabs">
            <button class="active" data-tab="vendas">Vendas</button>
            <button data-tab="analitico">Analítico</button>
            <button data-tab="diagnostico">Diagnóstico</button>
          </div>
        </div>
      </div>

      <!-- ABA VENDAS -->
      <section class="section tab" id="tab-vendas" style="display:block">
        <div class="kpis">
          <div class="kpi active"><h4>Faturamento <span class="delta up">▲ 12,8%</span></h4><div class="val">R$ 1.234.567</div><div style="font-size:11px;color:var(--muted);margin-top:6px">Anterior: R$ 1.094.000</div></div>
          <div class="kpi"><h4>Pedidos <span class="delta up">▲ 8,4%</span></h4><div class="val">32.104</div><div style="font-size:11px;color:var(--muted);margin-top:6px">Anterior: 29.620</div></div>
          <div class="kpi"><h4>Ticket Médio <span class="delta up">▲ 4,0%</span></h4><div class="val">R$ 38,43</div><div style="font-size:11px;color:var(--muted);margin-top:6px">Anterior: R$ 36,94</div></div>
          <div class="kpi"><h4>Incentivos <span class="delta down">▼ 2,1%</span></h4><div class="val">R$ 74.900</div><div style="font-size:11px;color:var(--muted);margin-top:6px">Anterior: R$ 76.500</div></div>
        </div>

        <div class="panel">
          <div class="card">
            <div class="head">
              <div class="title">Vendas por mês — últimos 12M vs 12M anteriores</div>
              <div class="seg"><button class="active">Total</button><button>Média</button></div>
            </div>
            <div class="chart" aria-label="preview de gráfico"><svg class="sk" viewBox="0 0 600 220" preserveAspectRatio="none"><rect x="0" y="200" width="600" height="1" fill="#e5e7eb"/><rect x="40" y="120" width="24" height="80" fill="var(--wine)"/><rect x="80" y="140" width="24" height="60" fill="var(--wine)"/><rect x="120" y="110" width="24" height="90" fill="var(--wine)"/><rect x="160" y="150" width="24" height="50" fill="var(--wine)"/><rect x="200" y="100" width="24" height="100" fill="var(--wine)"/><path d="M40 160 L80 150 L120 140 L160 155 L200 130 L240 135" stroke="#94a3b8" stroke-width="3" stroke-dasharray="6 6" fill="none"/></svg></div>
            <div style="display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:8px;color:var(--muted);font-size:12px">
              <span style="display:inline-flex;align-items:center;gap:6px"><span style="width:10px;height:10px;border-radius:2px;background:var(--wine)"></span> Atual</span>
              <span style="display:inline-flex;align-items:center;gap:6px"><span style="width:10px;height:2px;background:#94a3b8"></span> Anterior</span>
            </div>
          </div>
          <div class="side">
            <div class="card mini"><div class="head"><h4>Faturamento Médio</h4><span class="delta up">▲ 3,5%</span></div><div class="val" style="margin-top:4px">R$ 41.200</div><div style="font-size:11px;color:var(--muted)">Anterior: R$ 39.800</div></div>
            <div class="card mini"><div class="head"><h4>ROI</h4><span class="delta up">▲ 2,1%</span></div><div class="val" style="margin-top:4px">148%</div><div style="font-size:11px;color:var(--muted)">Anterior: 143%</div></div>
            <div class="card mini"><div class="head"><h4>% Incentivos</h4><span class="delta down">▼ 0,6%</span></div><div class="val" style="margin-top:4px">6,1%</div><div style="font-size:11px;color:var(--muted)">Anterior: 6,7%</div></div>
            <div class="card mini"><div class="head"><h4>Valor Cancelado</h4><span class="delta down">▼ 1,8%</span></div><div class="val" style="margin-top:4px">R$ 12.340</div><div style="font-size:11px;color:var(--muted)">Anterior: R$ 13.980</div></div>
          </div>
        </div>
      </section>

      <!-- ABA DIAGNÓSTICO -->
      <section class="section tab" id="tab-analitico" style="display:none">
        <div class="kpis" style="margin-top:-4px;margin-bottom:12px">
          <div class="kpi"><h4>Frete Total <span class="delta up">▲ 5,3%</span></h4><div class="val">R$ 54.120</div><div style="font-size:11px;color:var(--muted);margin-top:6px">Anterior: R$ 51.400</div></div>
          <div class="kpi"><h4>Frete Médio <span class="delta up">▲ 3,7%</span></h4><div class="val">R$ 6,12</div><div style="font-size:11px;color:var(--muted);margin-top:6px">Anterior: R$ 5,90</div></div>
          <div class="kpi"><h4>Pedidos Cancelados <span class="delta down">▼ 0,4%</span></h4><div class="val">1.204</div><div style="font-size:11px;color:var(--muted);margin-top:6px">Part.: 3,7% (Ant.: 4,1%)</div></div>
          <div class="kpi" style="opacity:.25;pointer-events:none"><h4>Slot livre (expansão futura)</h4><div class="val">—</div></div>
        </div>
        <div class="subgrid">
          <div class="card donut">
            <div class="head"><div class="title">Participação por loja — Top 6</div></div>
            <div class="chart" aria-label="preview de gráfico"><svg class="sk" viewBox="0 0 600 220" preserveAspectRatio="none"><rect x="0" y="200" width="600" height="1" fill="#e5e7eb"/><rect x="40" y="120" width="24" height="80" fill="var(--wine)"/><rect x="80" y="140" width="24" height="60" fill="var(--wine)"/><rect x="120" y="110" width="24" height="90" fill="var(--wine)"/><rect x="160" y="150" width="24" height="50" fill="var(--wine)"/><rect x="200" y="100" width="24" height="100" fill="var(--wine)"/><path d="M40 160 L80 150 L120 140 L160 155 L200 130 L240 135" stroke="#94a3b8" stroke-width="3" stroke-dasharray="6 6" fill="none"/></svg></div>
            <div class="center-badge">Total: R$ 0,00</div>
          </div>
          <div class="card"><div class="head"><div class="title">Vendas por dia da semana</div></div><div class="chart" aria-label="preview de gráfico"><svg class="sk" viewBox="0 0 600 220" preserveAspectRatio="none"><rect x="0" y="200" width="600" height="1" fill="#e5e7eb"/><rect x="40" y="120" width="24" height="80" fill="var(--wine)"/><rect x="80" y="140" width="24" height="60" fill="var(--wine)"/><rect x="120" y="110" width="24" height="90" fill="var(--wine)"/><rect x="160" y="150" width="24" height="50" fill="var(--wine)"/><rect x="200" y="100" width="24" height="100" fill="var(--wine)"/><path d="M40 160 L80 150 L120 140 L160 155 L200 130 L240 135" stroke="#94a3b8" stroke-width="3" stroke-dasharray="6 6" fill="none"/></svg></div></div>
          <div class="card"><div class="head"><div class="title">Vendas por hora</div></div><div class="chart" aria-label="preview de gráfico"><svg class="sk" viewBox="0 0 600 220" preserveAspectRatio="none"><rect x="0" y="200" width="600" height="1" fill="#e5e7eb"/><rect x="40" y="120" width="24" height="80" fill="var(--wine)"/><rect x="80" y="140" width="24" height="60" fill="var(--wine)"/><rect x="120" y="110" width="24" height="90" fill="var(--wine)"/><rect x="160" y="150" width="24" height="50" fill="var(--wine)"/><rect x="200" y="100" width="24" height="100" fill="var(--wine)"/><path d="M40 160 L80 150 L120 140 L160 155 L200 130 L240 135" stroke="#94a3b8" stroke-width="3" stroke-dasharray="6 6" fill="none"/></svg></div></div>
          <div class="card"><div class="head"><div class="title">Vendas por turno</div></div><div class="chart" aria-label="preview de gráfico"><svg class="sk" viewBox="0 0 600 220" preserveAspectRatio="none"><rect x="0" y="200" width="600" height="1" fill="#e5e7eb"/><rect x="40" y="120" width="24" height="80" fill="var(--wine)"/><rect x="80" y="140" width="24" height="60" fill="var(--wine)"/><rect x="120" y="110" width="24" height="90" fill="var(--wine)"/><rect x="160" y="150" width="24" height="50" fill="var(--wine)"/><rect x="200" y="100" width="24" height="100" fill="var(--wine)"/><path d="M40 160 L80 150 L120 140 L160 155 L200 130 L240 135" stroke="#94a3b8" stroke-width="3" stroke-dasharray="6 6" fill="none"/></svg></div></div>
        </div>
      </section>

      <!-- ABA DIAGNÓSTICO (Insights com IA) -->
      <section class="section tab" id="tab-diagnostico" style="display:none">
  <h3 style="margin:0 0 8px 2px;color:#334155">Diagnóstico — selecione um KPI</h3>
  <div class="kpi-picker">
    <button class="kpi-pill active">Faturamento</button>
    <button class="kpi-pill">Pedidos</button>
    <button class="kpi-pill">Ticket Médio</button>
    <button class="kpi-pill">Incentivos</button>
    <button class="kpi-pill">Faturamento Médio</button>
    <button class="kpi-pill">ROI</button>
    <button class="kpi-pill">% Incentivos</button>
    <button class="kpi-pill">Valor Cancelado</button>
    <button class="kpi-pill">Frete Total</button>
    <button class="kpi-pill">Frete Médio</button>
    <button class="kpi-pill">Pedidos Cancelados</button>
  </div>
  <div class="org-bar" style="display:flex;gap:8px;align-items:center;margin:6px 0 8px">
    <button id="layoutToggle" class="pill" type="button">Editar layout</button>
    <span class="drag-hint" style="color:#64748b">Dica: arraste para reordenar, use a alça para redimensionar e segure <strong>Shift</strong> ao soltar para <em>nest</em> (colocar um card dentro de outro).</span>
  </div>

  <!-- LAYOUT EDITÁVEL: HERO + 3 CARDS -->
  <div class="diag-layout">
    <div class="diag-card2 hero">
      <div class="diag-hero">
        <h4>Faturamento</h4>
        <span class="delta up">▲ 12,8%</span>
        <div class="val">R$ 1.234.567</div>
        <div class="prev">Anterior: R$ 1.094.000</div>
      </div>
      <div style="font-size:11px;color:#334155">Lojas destaque: Savassi, Estoril • Janelas: 11–14h • Canal: Delivery</div>
    </div>

    <!-- INSIGHTS -->
    <div class="diag-card2 tall">
      <div class="head" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <div class="title">Insights (IA)</div>
      </div>
      <div class="ins-list">
        <div class="ins-card up">
          <div class="dot"></div>
          <div>
            <div class="ins-title">Aceleração nas últimas 4 semanas</div>
            <div class="ins-sub">Drivers: pedidos (+8,4%), ticket (+4,0%).</div>
            <div class="ins-action">Ação: reforçar <strong>combos almoço</strong> e replicar vitrine das Top 3.</div>
          </div>
        </div>
        <div class="ins-card down">
          <div class="dot"></div>
          <div>
            <div class="ins-title">Subsídio acima do ideal no iFood (11–14h)</div>
            <div class="ins-sub">Regra linear reduz margem sem ganho de volume.</div>
            <div class="ins-action">Ação: migrar para <strong>tiers 60/90/120</strong> e condicionar a SLA &lt; 35min.</div>
          </div>
        </div>
        <div class="ins-card up">
          <div class="dot"></div>
          <div>
            <div class="ins-title">Elasticidade positiva no almoço</div>
            <div class="ins-sub">Mix de combos +2,1pp e preço +R$ 1,12.</div>
            <div class="ins-action">Ação: bundle com sobremesa aos sábados.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- GRÁFICOS -->
    <div class="diag-card2">
      <div class="head" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <div class="title">Gráficos</div>
        <div class="seg"><button class="active">12M</button><button>6M</button><button>30D</button></div>
      </div>
      <div class="chart" style="height:180px;border:1px dashed #d8dbe2;border-radius:10px;margin-bottom:8px" aria-label="preview de gráfico">
        <svg class="sk" viewBox="0 0 600 180" preserveAspectRatio="none"><rect x="0" y="160" width="600" height="1" fill="#e5e7eb"/><rect x="40" y="100" width="24" height="60" fill="var(--wine)"/><rect x="80" y="120" width="24" height="40" fill="var(--wine)"/><rect x="120" y="90" width="24" height="70" fill="var(--wine)"/><rect x="160" y="130" width="24" height="30" fill="var(--wine)"/><rect x="200" y="80" width="24" height="80" fill="var(--wine)"/><path d="M40 140 L80 132 L120 122 L160 136 L200 118 L240 120" stroke="#94a3b8" stroke-width="3" stroke-dasharray="6 6" fill="none"/></svg>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div class="chart" style="height:90px" aria-label="mini gráfico"><svg class="sk" viewBox="0 0 280 90"><rect x="0" y="80" width="280" height="1" fill="#e5e7eb"/><path d="M10 70 L70 50 L140 60 L210 30 L270 36" stroke="var(--wine)" stroke-width="3" fill="none"/></svg></div>
        <div class="chart" style="height:90px" aria-label="mini gráfico"><svg class="sk" viewBox="0 0 280 90"><rect x="0" y="80" width="280" height="1" fill="#e5e7eb"/><path d="M10 36 L70 32 L140 28 L210 24 L270 22" stroke="#94a3b8" stroke-width="3" stroke-dasharray="6 6" fill="none"/></svg></div>
      </div>
    </div>

    <!-- PROJEÇÕES -->
    <div class="diag-card2">
      <div class="head" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <div class="title">Projeções</div>
        <div class="proj-controls">
          <div class="seg"><button class="active">30D</button><button>60D</button><button>90D</button></div>
          <div class="seg"><button class="active">Base</button><button>Otimista</button><button>Conservador</button></div>
        </div>
      </div>
      <div class="proj-grid">
        <div class="chart" style="height:150px" aria-label="gráfico de projeção">
          <svg class="sk" viewBox="0 0 600 150" preserveAspectRatio="none"><rect x="0" y="140" width="600" height="1" fill="#e5e7eb"/><path d="M10 120 L70 108 L130 96 L190 88 L250 82 L310 74 L370 66 L430 60 L490 54 L550 48" stroke="var(--wine)" stroke-width="3" fill="none"/></svg>
        </div>
        <div class="kpi-quick">
          <div class="mini-metric"><div class="lbl">Receita proj.</div><div class="big">R$ 1,36M</div></div>
          <div class="mini-metric"><div class="lbl">Pedidos proj.</div><div class="big">34.900</div></div>
          <div class="mini-metric"><div class="lbl">Ticket proj.</div><div class="big">R$ 39,00</div></div>
        </div>
      </div>
      <div style="font-size:11px;color:var(--muted);margin-top:6px">Obs.: sem sazonalidade e com manutenção de mix atual.</div>
    </div>
  </div>
</section>

    </main>
  </div>

  <script>
// Tabs simples (Decisão / Diagnóstico)
document.getElementById('tabs').addEventListener('click', (e)=>{
  const btn=e.target.closest('button'); if(!btn) return;
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.toggle('active', b===btn));
  document.querySelectorAll('.tab').forEach(t=> t.style.display = (t.id==='tab-'+btn.dataset.tab)?'block':'none');
  window.scrollTo({top:0,behavior:'smooth'});
});

// Editor de layout (Diagnóstico): mover, redimensionar, aninhar e desagrupar — FIX completo
(function(){
  const toggle = document.getElementById('layoutToggle');
  const grid = document.querySelector('#tab-diagnostico .diag-layout');
  if(!toggle || !grid) return;

  let on=false, dragSrc=null, startX=0, startY=0, startW=0, startH=0, resizing=null, startSpan=1;
  const isCard = el=> el && el.classList && el.classList.contains('diag-card2');
  const isSub  = el=> el && el.classList && el.classList.contains('subbox');
  const allCards = ()=> Array.from(grid.querySelectorAll(':scope > .diag-card2'));
  const colInfo = ()=>{ const s=getComputedStyle(grid); const parts=(s.gridTemplateColumns.trim()||'').split(' ').filter(Boolean); const cols=parts.length||3; const gap=parseFloat(s.columnGap)||0; const cw=(grid.clientWidth-gap*(cols-1))/cols; return {cols,cw}; };

  function addResizeHandles(el){ if(el.querySelector(':scope > .resize-br')) return; ['br','b','r'].forEach(k=>{ const d=document.createElement('div'); d.className = 'resize-'+k; el.appendChild(d); d.addEventListener('mousedown', (e)=> onResizeStart(e, el)); }); }
  function addTools(el){ if(el.querySelector(':scope > .edit-tools')) return; const bar=document.createElement('div'); bar.className='edit-tools'; if(isCard(el) && el.parentElement.closest('.diag-card2')){ const unnest=document.createElement('button'); unnest.className='btn'; unnest.textContent='Desanilhar'; unnest.addEventListener('click',(e)=>{ e.stopPropagation(); grid.insertBefore(el, el.parentElement.nextSibling); el.style.gridColumn='span 4'; }); bar.appendChild(unnest);} if(isSub(el)){ const promote=document.createElement('button'); promote.className='btn'; promote.textContent='Promover a card'; promote.addEventListener('click',(e)=>{ e.stopPropagation(); const host=el.closest('.diag-card2'); const nc=document.createElement('div'); nc.className='diag-card2'; nc.appendChild(el); grid.insertBefore(nc, host.nextSibling); prepareCard(nc); }); bar.appendChild(promote);} el.appendChild(bar); }
  function makeDraggable(el){ el.draggable=true; el.addEventListener('dragstart', onDragStart); el.addEventListener('dragover', onDragOver); el.addEventListener('drop', onDrop); el.addEventListener('dragend', onDragEnd); }
  function prepareSubboxes(card){ const kids=[...card.children].filter(n=> !n.classList.contains('resize-br') && !n.classList.contains('resize-b') && !n.classList.contains('resize-r') && !n.classList.contains('edit-tools')); if(!card.dataset.prevDisplay){ card.dataset.prevDisplay=card.style.display||''; card.dataset.prevFlow=card.style.flexDirection||''; } card.style.display='flex'; card.style.flexDirection='column'; card.style.gap='8px'; kids.forEach(k=>{ k.classList.add('subbox'); makeDraggable(k); addResizeHandles(k); addTools(k); }); }
  function restoreSubboxes(card){ [...card.querySelectorAll(':scope > .subbox')].forEach(s=>{ s.draggable=false; s.classList.remove('drop-hint'); }); card.style.display=card.dataset.prevDisplay||''; card.style.flexDirection=card.dataset.prevFlow||''; }
  function prepareCard(card){ card.classList.add('box'); makeDraggable(card); addResizeHandles(card); addTools(card); prepareSubboxes(card); }
  function cleanup(card){ card.classList.remove('box','dragging'); card.draggable=false; card.querySelectorAll('.resize-br,.resize-b,.resize-r,.edit-tools').forEach(h=> h.remove()); restoreSubboxes(card); }

  function onResizeStart(e, target){ e.preventDefault(); resizing=target; startX=e.clientX; startY=e.clientY; startW=target.offsetWidth; startH=target.offsetHeight; if(isCard(target)){ const {cols,cw}=colInfo(); startSpan=Math.max(1,Math.min(cols,Math.round(startW/cw))); } else { startSpan=1; } document.addEventListener('mousemove', onMove); document.addEventListener('mouseup', onUp); }
  function onMove(e){ if(!resizing) return; const dx=e.clientX-startX, dy=e.clientY-startY, el=resizing; el.style.minHeight=Math.max(100,startH+dy)+'px'; if(isCard(el)){ const {cols,cw}=colInfo(); let delta=Math.round(dx/cw); let span=Math.max(1,Math.min(cols,startSpan+delta)); el.style.gridColumn='span '+span; } else { el.style.width=Math.max(120,startW+dx)+'px'; } }
  function onUp(){ document.removeEventListener('mousemove', onMove); document.removeEventListener('mouseup', onUp); resizing=null; }
  function onDragStart(e){ dragSrc=this; this.classList.add('dragging'); e.dataTransfer.effectAllowed='move'; }
  function onDragOver(e){ e.preventDefault(); e.dataTransfer.dropEffect='move'; e.currentTarget.classList.add('drop-hint'); }
  function isBeforeHalf(e, el){ const r=el.getBoundingClientRect(); return (e.clientY - r.top) < r.height/2; }
  function onDrop(e){ e.preventDefault(); const t=e.currentTarget; t.classList.remove('drop-hint'); if(!dragSrc || dragSrc===t) return; const shift=e.shiftKey; const before=isBeforeHalf(e,t);
    if(isCard(dragSrc) && isCard(t)){ if(shift){ t.appendChild(dragSrc); } else { grid.insertBefore(dragSrc, before? t : t.nextSibling); } return; }
    if(isSub(dragSrc) && isSub(t)){ const host=t.parentElement; if(shift){ t.appendChild(dragSrc); } else { host.insertBefore(dragSrc, before? t : t.nextSibling); } return; }
    if(isSub(dragSrc) && isCard(t)){ if(shift){ t.appendChild(dragSrc); } else { t.insertBefore(dragSrc, t.firstChild); } return; }
    if(isCard(dragSrc) && isSub(t)){ t.appendChild(dragSrc); return; }
  }
  function onDragEnd(){ this.classList.remove('dragging'); }

  function setEditable(active){ document.body.classList.toggle('edit-mode', active); if(active){ grid.style.gridTemplateColumns='repeat(12,minmax(0,1fr))'; allCards().forEach(prepareCard);} else { grid.style.gridTemplateColumns=''; allCards().forEach(cleanup);} }
  toggle.addEventListener('click', ()=>{ on=!on; setEditable(on); toggle.classList.toggle('active', on); toggle.textContent = on? 'Concluir edição' : 'Editar layout'; });
})();
</script>
  <script>
    // Editor de layout (Diagnóstico): mover, redimensionar, aninhar e DESAGRUPAR
(function(){
  const toggle = document.getElementById('layoutToggle');
  const grid = document.querySelector('#tab-diagnostico .diag-layout');
  if(!toggle || !grid) return;
  let on=false, dragSrc=null, startX=0, startY=0, startW=0, startH=0, resizing=null, startSpan=1;

  const isCard = el=> el && el.classList && el.classList.contains('diag-card2');
  const isSub  = el=> el && el.classList && el.classList.contains('subbox');

  function allCards(){ return Array.from(grid.querySelectorAll(':scope > .diag-card2')); }

  function addResizeHandles(el){
    if(el.querySelector(':scope > .resize-br')) return;
    const br = document.createElement('div'); br.className = 'resize-br';
    const b  = document.createElement('div'); b.className  = 'resize-b';
    const r  = document.createElement('div'); r.className  = 'resize-r';
    el.appendChild(br); el.appendChild(b); el.appendChild(r);
    [br,b,r].forEach(h=> h.addEventListener('mousedown', (e)=> onResizeStart(e, el)));
  }

  function addTools(el){
    if(el.querySelector(':scope > .edit-tools')) return;
    const bar = document.createElement('div'); bar.className='edit-tools';
    if(isCard(el) && el.parentElement.closest('.diag-card2')){
      const unnest = document.createElement('button'); unnest.className='btn'; unnest.textContent='Desanilhar';
      unnest.addEventListener('click', (e)=>{ e.stopPropagation(); grid.insertBefore(el, el.parentElement.nextSibling); el.style.gridColumn='span 1'; });
      bar.appendChild(unnest);
    }
    if(isSub(el)){
      const promote = document.createElement('button'); promote.className='btn'; promote.textContent='Promover a card';
      promote.addEventListener('click', (e)=>{ e.stopPropagation(); promoteSubbox(el); });
      bar.appendChild(promote);
    }
    el.appendChild(bar);
  }

  function promoteSubbox(sub){
    const hostCard = sub.closest('.diag-card2');
    const newCard = document.createElement('div'); newCard.className='diag-card2';
    // mover o subbox para dentro do novo card
    newCard.appendChild(sub);
    grid.insertBefore(newCard, hostCard.nextSibling);
    prepareCard(newCard);
  }

  function makeDraggable(el){
    el.draggable = true;
    el.addEventListener('dragstart', onDragStart);
    el.addEventListener('dragover', onDragOver);
    el.addEventListener('drop', onDrop);
    el.addEventListener('dragend', onDragEnd);
  }

  function prepareSubboxes(card){
    const kids = Array.from(card.children).filter(n=> !n.classList.contains('resize-br') && !n.classList.contains('resize-b') && !n.classList.contains('resize-r') && !n.classList.contains('edit-tools'));
    kids.forEach(k=>{
      k.classList.add('subbox');
      makeDraggable(k); addResizeHandles(k); addTools(k);
    });
    if(!card.dataset.prevDisplay){ card.dataset.prevDisplay = card.style.display || ''; card.dataset.prevFlow = card.style.flexDirection || ''; }
    card.style.display = 'flex'; card.style.flexDirection = 'column'; card.style.gap = '8px';
  }

  function restoreSubboxes(card){
    const subs = Array.from(card.querySelectorAll(':scope > .subbox'));
    subs.forEach(s=>{ s.draggable=false; s.classList.remove('drop-hint'); });
    card.style.display = card.dataset.prevDisplay || ''; card.style.flexDirection = card.dataset.prevFlow || '';
  }

  function prepareCard(card){
    card.classList.add('box');
    makeDraggable(card); addResizeHandles(card); addTools(card);
    prepareSubboxes(card);
  }

  function setEditable(active){
    document.body.classList.toggle('edit-mode', active);
    allCards().forEach(card=>{
      if(active){ prepareCard(card); }
      else{
        card.classList.remove('box','dragging'); card.draggable=false;
        card.querySelectorAll('.resize-br,.resize-b,.resize-r,.edit-tools').forEach(h=> h.remove());
        restoreSubboxes(card); card.style.gridColumn = card.style.gridColumn || '';
      }
    });
  }

  function onResizeStart(e, target){
    e.preventDefault(); resizing = target; startX=e.clientX; startY=e.clientY; startW=target.offsetWidth; startH=target.offsetHeight;
    if(isCard(target)){
      const styles = getComputedStyle(grid);
      const parts = (styles.gridTemplateColumns.trim()||'').split(' ').filter(Boolean);
      const cols = parts.length || 3;
      const gap = parseFloat(styles.columnGap)||0; const cw = (grid.clientWidth - gap*(cols-1))/cols;
      startSpan = Math.max(1, Math.round(startW / cw));
    } else { startSpan = 1; }
    document.addEventListener('mousemove', onMove); document.addEventListener('mouseup', onUp);
  }

  function onMove(e){ if(!resizing) return; const dx=e.clientX-startX, dy=e.clientY-startY; const el=resizing;
    el.style.minHeight = Math.max(100, startH+dy)+"px";
    if(isCard(el)){
      const styles = getComputedStyle(grid);
      const parts = (styles.gridTemplateColumns.trim()||'').split(' ').filter(Boolean);
      const cols = parts.length || 3;
      const gap = parseFloat(styles.columnGap)||0; const cw = (grid.clientWidth - gap*(cols-1))/cols;
      let deltaCols = Math.round(dx / cw);
      let span = Math.max(1, Math.min(cols, startSpan + deltaCols));
      el.style.gridColumn = 'span '+span;
    } else {
      el.style.width = Math.max(120, startW+dx)+"px";
    }
  }
  function onUp(){ document.removeEventListener('mousemove', onMove); document.removeEventListener('mouseup', onUp); resizing=null; }

  function onDragStart(e){ dragSrc=this; this.classList.add('dragging'); e.dataTransfer.effectAllowed='move'; }
  function onDragOver(e){ e.preventDefault(); e.dataTransfer.dropEffect='move'; const t = e
