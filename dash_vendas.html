<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DASHBOARD ESTRATÉGICO — CFO v8.0</title>
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128"><rect x="0" y="0" width="128" height="128" rx="24" fill="%232f6ef7"/><text x="64" y="78" text-anchor="middle" font-family="Arial" font-size="56" fill="white">CFO</text></svg>'/>
  <style>
    /* ===================== CONFIG & Cores Originais ===================== */
    :root{
      --bg:#f6f8fb; --card:#ffffff; --ink:#0b1220; --muted:#667085; --line:#e6e7eb; --pri:#2f6ef7;
      --ok:#10b981; --down:#ef4444;
      --chip:#f7e9ed; --bar:#334155; --wine:#7b1e3a; --wine-soft:#9c3554;
      --c-now:#7b1e3a; --c-now-soft:#9c3554; --c-prev:#94a3b8; --c-prev-soft:#cbd5e1;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:14px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    .wrap{max-width:1300px;margin:28px auto;padding:0 16px}
    
    /* ===================== NOVA ESTRUTURA DE LAYOUT ===================== */
    
    /* Cabeçalho Compacto */
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;gap:16px;flex-wrap:wrap}
    .header h1{margin:0;font-size:28px;letter-spacing:.2px}
    .controls{display:flex;align-items:center;gap:12px}
    .period-display{background:var(--card);border:1px solid var(--line);padding:8px 14px;border-radius:10px;color:var(--muted);font-weight:600;white-space:nowrap}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:var(--card);cursor:pointer;font-weight:700}
    .btn-pri{background:var(--pri);color:#fff;border-color:var(--pri)}

    /* KPIs Principais (Headline) */
    .kpi-headline-grid{display:grid;grid-template-columns:2fr 1.5fr 1.5fr;gap:16px;margin-bottom:20px}
    .kpi-card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:20px;box-shadow:0 8px 24px rgba(10,18,32,.05)}
    .kpi-card .label{font-size:18px;color:var(--muted);margin-bottom:4px}
    .kpi-card .value{font-size:40px;font-weight:800;line-height:1.1;margin-bottom:12px}
    .kpi-card.main-kpi .value{color:var(--c-now)}
    .kpi-card .comparison{display:flex;align-items:center;gap:10px;font-size:14px}
    .kpi-card .prev-val{color:var(--muted)}
    .delta-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:999px;font-weight:800;font-size:13px}
    .delta-badge.up{background:rgba(123,30,58,.10);color:var(--wine)}
    .delta-badge.down{background:rgba(148,163,184,.15);color:#64748b}
    .delta-badge svg{width:14px;height:14px}

    /* Layout Principal (Gráfico + KPIs Secundários) */
    .main-content-grid{display:grid;grid-template-columns:1fr 380px;gap:16px;margin-bottom:20px}
    
    .chart-card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;box-shadow:0 8px 24px rgba(10,18,32,.05); display:flex; flex-direction:column;}
    .chart-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;gap:12px}
    .chart-title{font-weight:700;color:var(--muted)}
    .chart-box{position:relative;flex-grow:1;min-height:300px}
    .main-chart-container .chart-box{min-height:400px}
    .chart-box canvas{display:block;width:100%;height:100%}
    .seg{display:inline-flex;border:1px solid var(--line);border-radius:8px;overflow:hidden}
    .seg button{padding:6px 10px;border:0;background:#fff;cursor:pointer;font-weight:800}
    .seg button.active{background:var(--c-now);color:#fff}

    /* Painel Lateral de KPIs */
    .kpi-side-panel{display:flex;flex-direction:column;gap:16px}
    .kpi-side-panel .panel-title{font-size:16px;font-weight:700;padding:0 8px;margin-bottom:-4px}
    .kpi-side-item{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;box-shadow:0 4px 16px rgba(10,18,32,.04)}
    .kpi-side-item .label{font-weight:700;margin-bottom:4px;display:flex;justify-content:space-between;align-items:center}
    .kpi-side-item .val-main{font-size:22px;font-weight:800}
    .kpi-side-item .val-sub{font-size:14px;color:var(--muted);margin-left:8px}
    .kpi-side-item .comparison{margin-top:6px;font-size:13px;display:flex;align-items:center;gap:8px}
    
    /* Gráficos de Detalhamento (Base) */
    .charts-grid-bottom{display:grid;grid-template-columns:4fr 3fr 3fr;gap:16px}

    /* Responsividade */
    @media (max-width: 1200px){
      .main-content-grid{grid-template-columns:1fr 320px}
      .charts-grid-bottom{grid-template-columns:1fr 1fr}
      .charts-grid-bottom .chart-card:first-child{grid-column:span 2}
    }
    @media (max-width: 992px){
      .kpi-headline-grid{grid-template-columns:1fr}
      .main-content-grid{grid-template-columns:1fr}
      .kpi-side-panel{
        display:grid; grid-template-columns:1fr 1fr;
        flex-direction:row;
      }
    }
    @media (max-width: 768px){
      .header{flex-direction:column;align-items:flex-start}
      .charts-grid-bottom{grid-template-columns:1fr}
      .charts-grid-bottom .chart-card:first-child{grid-column:span 1}
      .kpi-side-panel{grid-template-columns:1fr}
      .kpi-card .value{font-size:32px;}
      .kpi-card .label{font-size:16px;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    
    <header class="header">
      <h1>DASHBOARD DE VENDAS</h1>
      <div class="controls">
        <div class="period-display">Período: 05/08/2025 - 03/09/2025</div>
        <button class="btn">📅 Filtrar</button>
        <button class="btn btn-pri">📤 Carregar Excel</button>
      </div>
    </header>

    <div class="kpi-headline-grid">
      <div class="kpi-card main-kpi">
        <div class="label">Faturamento</div>
        <div class="value">R$ 1.25M</div>
        <div class="comparison">
          <span class="prev-val">Anterior: R$ 1.18M</span>
          <span class="delta-badge up">
            <svg viewBox="0 0 20 20" fill="currentColor"><path d="M10 4l5 6h-3v6H8v-6H5l5-6z"/></svg>
            <span>5.9%</span>
          </span>
        </div>
      </div>
      <div class="kpi-card">
        <div class="label">Pedidos</div>
        <div class="value">10.430</div>
        <div class="comparison">
          <span class="prev-val">Anterior: 10.990</span>
          <span class="delta-badge down">
            <svg viewBox="0 0 20 20" fill="currentColor"><path d="M10 16l-5-6h3V4h4v6h3l-5 6z"/></svg>
            <span>5.1%</span>
          </span>
        </div>
      </div>
      <div class="kpi-card">
        <div class="label">Ticket Médio</div>
        <div class="value">R$ 119,85</div>
        <div class="comparison">
          <span class="prev-val">Anterior: R$ 107,37</span>
          <span class="delta-badge up">
            <svg viewBox="0 0 20 20" fill="currentColor"><path d="M10 4l5 6h-3v6H8v-6H5l5-6z"/></svg>
            <span>11.6%</span>
          </span>
        </div>
      </div>
    </div>
    
    <div class="main-content-grid">
      <div class="chart-card main-chart-container">
        <div class="chart-head">
          <div class="chart-title">Faturamento por Mês — Últimos 12M vs. 12M Anteriores</div>
          <div id="segGlobal" class="seg">
            <button class="seg-btn active" data-mode="total">Total</button>
            <button class="seg-btn" data-mode="media">Média</button>
          </div>
        </div>
        <div class="chart-box"><canvas id="ch_month"></canvas></div>
      </div>

      <div class="kpi-side-panel">
        <div class="panel-title">Métricas de Performance</div>
        <div class="kpi-side-item">
          <div class="label">Incentivos</div>
          <div><span class="val-main">R$ 50.120</span><span class="val-sub">(4,0% do Fat.)</span></div>
          <div class="comparison">
            <span class="prev-val">Anterior: R$ 48.900</span>
            <span class="delta-badge down">
              <svg viewBox="0 0 20 20" fill="currentColor"><path d="M10 16l-5-6h3V4h4v6h3l-5 6z"/></svg>
              <span>2.5%</span>
            </span>
          </div>
        </div>
        <div class="kpi-side-item">
          <div class="label">ROI</div>
          <div><span class="val-main">2.390%</span></div>
          <div class="comparison">
            <span class="prev-val">Anterior: 2.315%</span>
            <span class="delta-badge up">
              <svg viewBox="0 0 20 20" fill="currentColor"><path d="M10 4l5 6h-3v6H8v-6H5l5-6z"/></svg>
              <span>3.2%</span>
            </span>
          </div>
        </div>
        <div class="kpi-side-item">
          <div class="label">Frete Total</div>
          <div><span class="val-main">R$ 83.440</span><span class="val-sub">(Médio R$ 8,00)</span></div>
          <div class="comparison">
            <span class="prev-val">Anterior: R$ 85.100</span>
            <span class="delta-badge up">
              <svg viewBox="0 0 20 20" fill="currentColor"><path d="M10 4l5 6h-3v6H8v-6H5l5-6z"/></svg>
              <span>2.0%</span>
            </span>
          </div>
        </div>
        <div class="kpi-side-item">
          <div class="label">Cancelamentos</div>
          <div><span class="val-main">R$ 12.500</span><span class="val-sub">(105 pedidos)</span></div>
          <div class="comparison">
            <span class="prev-val">Anterior: R$ 15.000</span>
            <span class="delta-badge up">
              <svg viewBox="0 0 20 20" fill="currentColor"><path d="M10 4l5 6h-3v6H8v-6H5l5-6z"/></svg>
              <span>16.7%</span>
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="charts-grid-bottom">
      <div class="chart-card">
        <div class="chart-head">
          <div class="chart-title">Participação por Loja — Top 6</div>
        </div>
        <div class="chart-box"><canvas id="ch_top6"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-head">
          <div class="chart-title">Vendas por Dia da Semana</div>
        </div>
        <div class="chart-box"><canvas id="ch_dow"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-head">
          <div class="chart-title">Vendas por Período</div>
          <div class="seg">
            <button class="seg-btn active" data-mode="hora">Hora</button>
            <button class="seg-btn" data-mode="turno">Turno</button>
          </div>
        </div>
        <div class="chart-box"><canvas id="ch_hour"></canvas></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js" crossorigin="anonymous"></script>
  
  <script>
    /*
      NOTA IMPORTANTE:
      Este script é um exemplo para renderizar os gráficos com dados fictícios e demonstrar o layout.
      O JavaScript original (que se conecta ao Supabase) precisará ser adaptado para popular
      os novos elementos de HTML deste layout. A lógica de busca e cálculo de dados permanece válida,
      mas a parte que atualiza o DOM (ex: document.getElementById('...')) deverá ser refeita.
    */

    // ===================== CHART.JS — TEMA E HELPERS (Mantidos do Original) =====================
    Chart.defaults.font.family = 'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu';
    Chart.defaults.color = '#334155';
    Chart.defaults.plugins.legend.position = 'top';
    Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(15,23,42,.95)';
    function gradNow(ctx){
      const g = ctx.createLinearGradient(0,0,0, ctx.canvas.clientHeight);
      g.addColorStop(0,'rgba(123,30,58,0.95)');
      g.addColorStop(1,'rgba(156,53,84,0.55)');
      return g;
    }
    function gradPrev(ctx){
      const g = ctx.createLinearGradient(0,0,0, ctx.canvas.clientHeight);
      g.addColorStop(0,'rgba(148,163,184,0.85)');
      g.addColorStop(1,'rgba(203,213,225,0.45)');
      return g;
    }
    
    // ===================== DADOS FICTÍCIOS E RENDERIZAÇÃO DOS GRÁFICOS =====================
    (function renderCharts(){
      // Gráfico Principal: Mês a Mês
      const chMonth = document.getElementById('ch_month');
      if(chMonth){
        new Chart(chMonth.getContext('2d'), {
          type: 'bar',
          data: {
            labels: ['Set/24', 'Out/24', 'Nov/24', 'Dez/24', 'Jan/25', 'Fev/25', 'Mar/25', 'Abr/25', 'Mai/25', 'Jun/25', 'Jul/25', 'Ago/25'],
            datasets: [
              { label: 'Atual', data: [88, 95, 110, 130, 105, 98, 112, 115, 120, 122, 128, 125].map(v => v * 1000), backgroundColor: gradNow(chMonth.getContext('2d')) },
              { label: 'Anterior', data: [82, 90, 100, 125, 99, 92, 105, 108, 110, 115, 112, 118].map(v => v * 1000), backgroundColor: gradPrev(chMonth.getContext('2d')) }
            ]
          },
          options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
        });
      }

      // Gráfico Donut: Top 6 Lojas
      const chTop6 = document.getElementById('ch_top6');
      if(chTop6){
        new Chart(chTop6.getContext('2d'), {
          type: 'doughnut',
          data: {
            labels: ['Loja Centro', 'Loja Shopping A', 'Loja Bairro Sul', 'Loja Online', 'Loja Aeroporto', 'Outras'],
            datasets: [{ 
              data: [350000, 280000, 190000, 150000, 80000, 200000], 
              backgroundColor: ["#7b1e3a","#8c2947","#9c3554","#ad4061","#bd4c6e","#ce577b"],
              borderColor: '#fff', borderWidth: 2
            }]
          },
          options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'right' } } }
        });
      }

      // Gráfico de Barras: Dia da Semana
      const chDow = document.getElementById('ch_dow');
      if(chDow){
        new Chart(chDow.getContext('2d'), {
          type: 'bar',
          data: {
            labels: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],
            datasets: [{ label: 'Faturamento', data: [120, 150, 160, 170, 180, 250, 220].map(v => v * 1000), backgroundColor: gradNow(chDow.getContext('2d')) }]
          },
          options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
        });
      }

      // Gráfico de Barras: Por Hora
      const chHour = document.getElementById('ch_hour');
      if(chHour){
        new Chart(chHour.getContext('2d'), {
          type: 'line',
          data: {
            labels: ['08h', '10h', '12h', '14h', '16h', '18h', '20h', '22h'],
            datasets: [{ label: 'Vendas', data: [30, 60, 110, 90, 80, 150, 180, 120].map(v => v * 1000), borderColor: '#7b1e3a', backgroundColor: 'rgba(123,30,58,0.1)', fill: true, tension: 0.3 }]
          },
          options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });
      }
    })();
  </script>
</body>
</html>
