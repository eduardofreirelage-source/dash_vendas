<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dash Pratos</title>
  <style>
    :root{
      --bg:#f7f7fa; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb;
      --wine:#7b1e3a; --wine-2:#8c2947; --chip:#fef2f2; --ok:#0b5d47; --down:#ef4444;
      --c-now:#7b1e3a; --c-prev:#9ca3af;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font:11px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; height: 100%; overflow: hidden;}
    .wrap{display:flex;flex-direction:column;min-height:100vh; height: 100%; overflow: hidden;}
    .main{flex:1;min-width:0;display:flex;flex-direction:column; overflow-y: auto; padding-bottom: 60px;}
    .top{position:sticky;top:0;z-index:10;background:var(--card);padding:10px 14px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:16px;margin-bottom:8px;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px; font-size:16px; font-weight: 700; color: var(--ink);}
    .section{order:2;padding:0 16px 12px 16px}
    .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:12px}
    .kpi{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:8px;transition:.2s;position:relative}
    .kpi h4{margin:0 0 4px 0;color:var(--muted);font-size:11px;display:flex;align-items:center;gap:6px;}
    .kpi h4 .spacer { flex-grow: 1; }
    .kpi .val{font-size:22px;font-weight:500;letter-spacing:-.5px}
    .kpi .sub{font-size:10px;color:var(--muted);margin-top:4px}
    .delta{display:inline-flex;gap:4px;align-items:center;padding:1px 6px;border-radius:999px;border:1px solid rgba(148,163,184,.35);font-weight:700;font-size:10px;margin-left:6px;background:rgba(148,163,184,.15);color:#6b7280}
    .delta svg{width:10px;height:10px;fill:currentColor}
    .delta.up{background:rgba(123,30,58,.10);border-color:rgba(123,30,58,.25);color:var(--wine)}
    .delta.down{background:rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.25); color: var(--down); }
    .charts-grid{display:grid; grid-template-columns: repeat(2, 1fr); gap: 10px; flex: 1;}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:8px;display:flex;flex-direction:column; min-height: 200px; }
    .card .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px; flex-shrink: 0;}
    .title{font-weight:700; color: var(--ink)}
    .seg{display:inline-flex;border:1px solid var(--line);border-radius:8px;overflow:hidden}
    .seg button{padding:4px 8px;border:0;background:#fff;font-weight:700;color:#475569;cursor:pointer; font-size: 10px;}
    .seg button.active{background:var(--wine);color:#fff}
    .chart-box{position:relative;flex-grow:1;min-height:180px;}
    .chart-box canvas{display:block;width:100%;height:100%}
    @media (max-width:1200px){ .kpis{grid-template-columns:repeat(2,1fr)} .charts-grid{grid-template-columns:1fr} }
    @media (max-width: 768px) { .kpis{ grid-template-columns: 1fr; } .top { flex-direction: column; align-items: flex-start; } }
    .spinner { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 50; display: none; align-items: center; justify-content: center; }
    .modal-backdrop.modal-show { display: flex; }
    .modal-content { background: var(--card); padding: 16px 20px; border-radius: 12px; max-width: 400px; width: 90%; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .modal-content h4 { margin: 0 0 8px 0; font-size: 14px; }
    .modal-content p { margin: 0 0 16px 0; font-size: 11px; color: var(--muted); }
    .modal-actions { display: flex; gap: 8px; justify-content: flex-end; }
    .fx-textbtn.secondary { background: #e5e7eb; }
    .top10-header-row, .top10-row { display: flex; align-items: center; padding: 0 8px; flex-shrink: 0; }
    .top10-header-row { font-size: 10px; font-weight: 700; color: var(--muted); text-transform: uppercase; border-bottom: 1px solid var(--line); padding-bottom: 6px; margin-bottom: 2px; }
    .top10-list-body { display: flex; flex-direction: column; flex-grow: 1; min-height: 0; }
    .top10-row { flex-grow: 1; border-bottom: 1px solid #f0f2f5; font-size: 11px; }
    .top10-row:last-child { border-bottom: none; }
    .top10-col-rank { flex: 0 0 30px; font-weight: 700; text-align: center; color: var(--muted); }
    .top10-col-prato { flex: 1 1 auto; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500; padding-right: 8px; }
    .top10-col-qty { flex: 0 0 50px; text-align: right; font-weight: 700; }
    .top10-row[data-rank="1"] .top10-col-rank { color: #d4af37; font-size: 14px; }
    .top10-row[data-rank="2"] .top10-col-rank { color: #c0c0c0; font-size: 13px; }
    .top10-row[data-rank="3"] .top10-col-rank { color: #cd7f32; font-size: 12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <main class="main main-content">
      <div class="top">
        <div class="brand">Dashboard de Pratos</div>
        <div class="seg" id="segDowMode"><button data-mode="TOTAL" class="active">TOTAL</button><button data-mode="MEDIA">MÉDIA</button></div>
      </div>
      <section class="section">
        <div class="kpis">
          <div class="kpi"><h4><span>Itens Vendidos</span><span class="spacer"></span><span id="d_qtd" class="delta flat">—</span></h4><div class="val" id="k_qtd">—</div><div class="sub">Anterior: <span id="p_qtd">—</span></div></div>
          <div class="kpi"><h4><span>Pratos/Itens Únicos</span><span class="spacer"></span><span id="d_pratos_unicos" class="delta flat">—</span></h4><div class="val" id="k_pratos_unicos">—</div><div class="sub">Anterior: <span id="p_pratos_unicos">—</span></div></div>
          <div class="kpi"><h4><span>Média Diária</span><span class="spacer"></span><span id="d_media_diaria" class="delta flat">—</span></h4><div class="val" id="k_media_diaria">—</div><div class="sub">Anterior: <span id="p_media_diaria">—</span></div></div>
        </div>
        <div class="card" style="margin-bottom: 10px;">
            <div class="head"><div class="title">Vendas por Mês</div></div>
            <div class="chart-box" style="height: 184px; min-height: 184px;"><canvas id="ch_month"></canvas></div>
        </div>
        <div class="charts-grid">
            <div class="card">
                <div class="head">
                    <div class="title">Vendas por Dia da Semana</div>
                    <button id="btnExportDow" class="fx-iconbtn" title="Exportar CSV" style="width: 28px; height: 28px;"><svg id="iconDownload" fill="currentColor" viewBox="0 0 20 20"><path d="M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"/></svg><svg id="iconSpinner" class="spinner" fill="none" viewBox="0 0 24 24" style="display:none;"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" opacity="0.25"></circle><path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" opacity="0.75"></path></svg></button>
                </div>
              <div class="chart-box"><canvas id="ch_dow"></canvas></div>
            </div>
            <div class="card">
                <div class="head">
                    <div class="title">Top 10 Pratos</div>
                    <div class="seg" id="segTop10"><button data-mode="MAIS" class="active">Mais Vendidos</button><button data-mode="MENOS">Menos Vendidos</button></div>
                </div>
                <div class="top10-header-row"><span class="top10-col-rank">#</span><span class="top10-col-prato">Prato</span><span class="top10-col-qty">Qtd.</span></div>
                <div id="top10-list-body" class="top10-list-body"></div>
            </div>
        </div>
      </section>
    </main>
  </div>
  <style>
    /* ... estilos da barra de filtros ... */
  </style>
  <footer class="fx-filters-bar">
    </footer>
  <div class="fx-dropup" id="fxDropup">
    </div>
  <div id="exportModal" class="modal-backdrop">
    </div>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
  /* ===================== CONFIG (PROJETO ESTOQUE) ===================== */
  const SUPABASE_URL_ESTOQUE  = 'https://tykdmxaqvqwskpmdiekw.supabase.co';
  const SUPABASE_ANON_ESTOQUE = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR5a2RteGFxdnF3c2twbWRpZWt3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyOTg2NDYsImV4cCI6MjA3Mjg3NDY0Nn0.XojR4nVx_Hr4FtZa1eYi3jKKSVVPokG23jrJtm8_3ps';
  const supaEstoque = window.supabase.createClient(SUPABASE_URL_ESTOQUE, SUPABASE_ANON_ESTOQUE);
  
  // O restante do código JS com `supa.` trocado por `supaEstoque.`
  
  /* ===================== CHART DEFAULTS ===================== */
  Chart.defaults.font.family = '-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif';
  /* ... resto das configurações do Chart.js ... */

  /* ===================== HELPERS ===================== */
  const $ = id => document.getElementById(id);
  const num = v => (v==null||!isFinite(+v)) ? '0' : (+v).toLocaleString('pt-BR');
  /* ... resto das funções helper ... */

  /* ... restante do código JS do dash_pratos, usando supaEstoque ... */
  async function reloadFilterOptions() {
    const [unids, cats, pratos] = await Promise.all([
      supaEstoque.from('vendas_pratos_unidades').select('unidade'),
      supaEstoque.from('vendas_pratos_categorias').select('categoria'),
      supaEstoque.from('vendas_pratos_pratos').select('prato')
    ]);
    ms.unids.setOptions((unids.data?.map(r => r.unidade) || []).filter(Boolean));
    ms.cats.setOptions(cats.data?.map(r => r.categoria).filter(c => c !== null) || []);
    ms.pratos.setOptions(pratos.data?.map(r => r.prato).filter(p => p !== null) || []);
  }

  // ... etc
  </script>
</body>
</html>
