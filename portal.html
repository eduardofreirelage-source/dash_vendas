<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Pratos & Produção – Sistema Unificado</title>
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128"><rect x="0" y="0" width="128" height="128" rx="22" fill="%237b1e3a"/><text x="64" y="78" text-anchor="middle" font-family="Arial" font-size="56" fill="white">UN</text></svg>'/>
  <style>
    :root{ --bg:#f6f8fb; --card:#fff; --ink:#101828; --line:#e7e9ee; }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;height:100%}
    .wrap{max-width:1200px;margin:26px auto;padding:0 16px}
    h1{margin:0 0 12px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .tab{padding:9px 14px;border:1px solid #e7e9ee;border-radius:10px;background:#fff;cursor:pointer}
    .tab.active{background:#eef2f6;font-weight:700}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:0 8px 24px rgba(16,24,40,.05)}
    .frame-wrap{padding:12px}
    .hint{color:#64748b;font-size:12px;margin:8px 0 12px}
    iframe{width:100%;border:0;display:block;height:calc(100vh - 220px);} /* fallback */
    .fallback{margin:12px 0}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid #e7e9ee;background:#fff;cursor:pointer}
  </style>
</head>
<body>
<div class="wrap">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
    <h1>Pratos & Produção – Sistema Unificado</h1>
    <div id="status" style="font-size:13px;color:#059669">Pronto</div>
  </div>

  <div class="tabs">
    <button class="tab active" data-tab="dash">Dash Pratos</button>
    <button class="tab" data-tab="producao">Produção</button>
    <button class="tab" data-tab="cadastros">Cadastros</button>
  </div>

  <div class="card frame-wrap">
    <div class="hint">Conteúdo em iframe. Arquivo atual: <span id="info-arquivo"></span></div>
    <iframe id="frame" title="Módulo" loading="eager" referrerpolicy="no-referrer"></iframe>
    <div id="fallback" class="fallback" style="display:none">
      Não foi possível carregar no iframe.
      <a id="fallback-link" class="btn" target="_blank" rel="noopener">Abrir em nova aba</a>
    </div>
  </div>
</div>

<script>
  // ========= Ajuste aqui se preciso =========
  const PATHS = {
    DASH:      './dash_pratos.html',     // se seu dash está em pasta, use './dash_pratos/index.html'
    PRODUCAO:  './app.html#producao',
    CADASTROS: './app.html#cadastros'
  };
  // =========================================

  const $  = (sel,root=document)=> root.querySelector(sel);
  const $$ = (sel,root=document)=> Array.from(root.querySelectorAll(sel));

  function setInfo(src){ $('#info-arquivo').textContent = src; }

  // Redimensiona via leitura direta (mesma origem) ou via postMessage (qualquer origem)
  function attachResizer(frame){
    const resizeByRead = ()=>{
      try{
        const doc = frame.contentDocument || frame.contentWindow?.document;
        if(!doc) return;
        const h = Math.max(
          doc.body?.scrollHeight || 0,
          doc.documentElement?.scrollHeight || 0,
          600
        );
        frame.style.height = (h + 20) + 'px';
      }catch(e){
        // cross-origin -> fica no fallback
      }
    };

    // polling de segurança (p/ gráficos que montam depois)
    const poll = setInterval(resizeByRead, 600);
    frame.addEventListener('load', ()=> {
      resizeByRead();
      setTimeout(resizeByRead, 300);
    });

    // postMessage (recomendado): o conteúdo manda {kind:'resize',h:n}
    window.addEventListener('message', (ev)=>{
      if(!ev?.data || ev.data.kind!=='resize') return;
      const h = Math.max( Number(ev.data.h||0), 600);
      frame.style.height = (h + 20) + 'px';
    });

    // limpa se trocar de módulo
    return ()=> { clearInterval(poll); };
  }

  let detach = null;

  function loadModule(src){
    const frame = $('#frame');
    const fb    = $('#fallback');
    const fblnk = $('#fallback-link');
    setInfo(src);

    if (detach) detach();
    detach = attachResizer(frame);

    fb.style.display = 'none';
    frame.src = src;

    // fallback visual se não carregar em 3s
    let timer = setTimeout(()=>{
      fb.style.display = 'block';
      fblnk.href = src;
    }, 3000);

    frame.onload = ()=> { clearTimeout(timer); fb.style.display='none'; };
  }

  function activateTab(key){
    $$('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab===key));
    if(key==='dash')      loadModule(PATHS.DASH);
    if(key==='producao')  loadModule(PATHS.PRODUCAO);
    if(key==='cadastros') loadModule(PATHS.CADASTROS);
  }

  $$('.tab').forEach(btn => btn.addEventListener('click', ()=> activateTab(btn.dataset.tab)));
  activateTab('dash'); // inicial
</script>
</body>
</html>
